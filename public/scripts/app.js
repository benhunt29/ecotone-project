var app=angular.module("ecotoneApp",["ngRoute","ngMaterial","ngMessages","validation.match"]);app.config(["$mdThemingProvider","$routeProvider","$locationProvider","$httpProvider",function(e,t,o,n){o.html5Mode(!0),e.theme("default").primaryPalette("green").accentPalette("blue-grey",{"default":"600"}).warnPalette("orange"),t.when("/",{templateUrl:"/views/calculator.html",controller:"calculateCtrl as ctrl"}).when("/login",{templateUrl:"/views/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"/views/register.html",controller:"createAccountCtrl"}).when("/admin",{templateUrl:"/views/admin.html",controller:"adminCtrl as ctrl"}).when("/account",{templateUrl:"/views/account.html",controller:""}).when("/dashboard",{templateUrl:"/views/dashboard.html",controller:"dashboardCtrl"}).when("/projects",{templateUrl:"/views/project.html",controller:"projectsCtrl as ctrl"}).when("/about",{templateUrl:"/views/about.html"}).when("/contact",{templateUrl:"/views/contact.html",controller:""}).when("/privacy",{templateUrl:"/views/privacy.html"}).when("/sources",{templateUrl:"/views/sources.html"}).otherwise({redirectTo:"/"})}]),app.controller("adminCtrl",["$http",function(e){function t(t){var n=t.id;console.log(n),e.put("/suggestion/complete/"+n).then(function(e){o()})}function o(){e.get("/suggestion").then(function(e){var t=e.data;console.log(t),n.suggestions=t})}o();var n=this;n.suggestions="",n.markComplete=t}]),app.controller("adminCtrl",["$http",function(e){function t(t){var n=t.id;console.log(n),e.put("/suggestion/complete/"+n).then(function(e){o()})}function o(){e.get("/suggestion").then(function(e){var t=e.data;console.log(t),n.suggestions=t})}o();var n=this;n.suggestions="",n.markComplete=t}]),app.controller("calculateCtrl",["$http","$mdDialog","$rootScope","authService","$location",function(e,t,o,n,r){function a(e){console.log("Text changed to ",e)}function c(e){void 0==e&&(h.category="",h.subcategory="",h.warmId="",h.weight="",h.conversion="",h.result="")}function l(){var t={warmId:h.warmId||h.category.secondaries[0].warm_id,weight:parseFloat(h.weight)*h.conversion};e.post("/calculations",t).then(function(e){h.result=Math.floor(1e3*Math.abs(e.data))/1e3})}function i(e){return e?h.list.filter(s(e)):h.list}function s(e){var t=e.toLowerCase();return function(e){return-1!=e.primary_cat.indexOf(t)}}function u(){e.post("/suggestion",h.submission).then(function(e){t.hide()})}function p(e){document.getElementById("sidenav").focus(),t.show({templateUrl:"/views/submit-modal.html",clickOutsideToClose:!0,controller:"calculateCtrl",controllerAs:"ctrl",locals:{material:h.searchText}})}o.user=n.getUser(),o.user&&o.user.username&&r.path("/"),e.get("/materials").then(function(e){var t=e.data;t.forEach(function(e){e.primary_cat=e.primary_cat.toLowerCase()}),h.list=t});var h=this;h.list="",h.isDisabled=!1,h.result="",h.querySearch=i,h.selectedItemChange=c,h.searchTextChange=a,h.newSuggestion=p,h.submitSuggestion=u,h.units=[{name:"lbs",conversion:5e-4},{name:"kilos",conversion:.00110231},{name:"tons",conversion:1},{name:"metric tons",conversion:1.10231}],h.submission={email:"",material:"",notes:""},h.newCalculation=l}]),app.controller("createAccountCtrl",["$scope","$http","$location",function(e,t,o){e.user={},e.processForm=function(n){console.log("Posting..."),t({method:"POST",url:"/register",data:e.user,dataType:"json"}).then(function(e){console.log(e),o.path("/login"),alert("Your account has been created.")})}}]),app.controller("dashboardCtrl",["$mdDialog","$scope","$http",function(e,t,o){o.get("/project").then(function(e){console.log(e),t.projectList=e.data}),t.showDelete=function(o){console.log("CLICK");var n=e.confirm().title("Are you sure you want to delete your project?").content("This is permanent.").ariaLabel("Delete project permanently").ok("Delete").cancel("Cancel").targetEvent(o);e.show(n).then(function(){t.alert="Your project has been deleted."},function(){t.alert="Your project has not been deleted."})}}]),app.controller("loginCtrl",["$scope","$http","authService","$location","$rootScope",function(e,t,o,n,r){e.login=function(){t({method:"POST",url:"/login",data:e.form}).then(function(e){o.saveToken(e.data.token),r.user=o.getUser(),n.path("/")})}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location","$http",function(e,t,o,n,r){o.user=e.getUser(),o.user&&o.user.username&&n.path("/"),t.logout=function(){e.logout(),o.user=e.getUser(),n.path("/")}}]),app.controller("projectsCtrl",["$scope","$http",function(e,t){function o(e){return e?l.projectList.filter(n(e)):l.projectList}function n(e){var t=e.toLowerCase();return function(e){return-1!=e.primary_cat.indexOf(t)}}function r(e){console.log("Text changed to ",e)}function a(e){void 0==e&&(l.project_name="",l.project_description="")}function c(){console.log("Deleting...",l.projectList.ID)}var l=this;l.projectList="",l.result="",l.querySearch=o,l.selectedItemChange=a,l.searchTextChange=r,l.projectTotal=0,l.deleteProjectItem=c,l.id=0,l.getProjectList=function(){t.get("/project",userid).then(function(e){console.log(e);var t=e.data;t.forEach(function(e){project_name=e.project_name.toLowerCase(),project_description=e.project_description,id=e.id}),l.projectList=t})}}]),app.service("authService",["$window",function(e){this.parseJwt=function(t){if(t){var o=t.split(".")[1],n=o.replace("-","+").replace("_","/");return JSON.parse(e.atob(n))}return{}},this.saveToken=function(t){e.localStorage.jwtToken=t,console.log("Saved token:",e.localStorage.jwtToken)},this.getToken=function(){return e.localStorage.jwtToken},this.isAuthed=function(){var e=this.getToken();if(e){var t=this.parseJwt(e),o=Math.round((new Date).getTime()/1e3)<=t.exp;return o||this.logout(),o}return!1},this.logout=function(){delete e.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(e,t,o){return{request:function(e){return e.headers=e.headers||{},o.isAuthed()&&(e.headers.Authorization="Bearer "+o.getToken()),e},response:function(o){return 401===o.status&&t.path("/login"),o||e.when(o)},responseError:function(o){return 401===o.status?t.path("/login"):console.log(o),e.reject(o)}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiLCJzY3JpcHRzL2FkbWluQ3RybC5qcyIsInNjcmlwdHMvYXBwLmpzIiwic2NyaXB0cy9jYWxjdWxhdGVDdHJsLmpzIiwic2NyaXB0cy9jcmVhdGVBY2NvdW50Q3RybC5qcyIsInNjcmlwdHMvZGFzaGJvYXJkQ3RybC5qcyIsInNjcmlwdHMvbG9naW5DdHJsLmpzIiwic2NyaXB0cy9uYXZDdHJsLmpzIiwic2NyaXB0cy9wcm9qZWN0c0N0cmwuanMiLCJzY3JpcHRzL3NlcnZpY2VzLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImh0bWw1TW9kZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiZGVmYXVsdCIsIndhcm5QYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCIkaHR0cCIsIm1hcmtDb21wbGV0ZSIsInN1Z2dlc3Rpb24iLCJpZCIsImNvbnNvbGUiLCJsb2ciLCJwdXQiLCJ0aGVuIiwicmVzIiwiaW5pdCIsImdldCIsInN1Z2dlc3Rpb25zIiwiZGF0YSIsInNlbGYiLCJ0aGlzIiwiJG1kRGlhbG9nIiwiJHJvb3RTY29wZSIsImF1dGhTZXJ2aWNlIiwiJGxvY2F0aW9uIiwic2VhcmNoVGV4dENoYW5nZSIsInRleHQiLCJzZWxlY3RlZEl0ZW1DaGFuZ2UiLCJpdGVtIiwidW5kZWZpbmVkIiwiY2F0ZWdvcnkiLCJzdWJjYXRlZ29yeSIsIndhcm1JZCIsIndlaWdodCIsImNvbnZlcnNpb24iLCJyZXN1bHQiLCJuZXdDYWxjdWxhdGlvbiIsImNhbGN1bGF0ZSIsInNlY29uZGFyaWVzIiwid2FybV9pZCIsInBhcnNlRmxvYXQiLCJwb3N0IiwicmVzcG9uc2UiLCJNYXRoIiwiZmxvb3IiLCJhYnMiLCJxdWVyeVNlYXJjaCIsInF1ZXJ5IiwibGlzdCIsImZpbHRlciIsImNyZWF0ZUZpbHRlckZvciIsImxvd2VyY2FzZVF1ZXJ5IiwidG9Mb3dlckNhc2UiLCJvYmoiLCJwcmltYXJ5X2NhdCIsImluZGV4T2YiLCJzdWJtaXRTdWdnZXN0aW9uIiwic3VibWlzc2lvbiIsImhpZGUiLCJuZXdTdWdnZXN0aW9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImZvY3VzIiwic2hvdyIsImNsaWNrT3V0c2lkZVRvQ2xvc2UiLCJjb250cm9sbGVyQXMiLCJsb2NhbHMiLCJtYXRlcmlhbCIsInNlYXJjaFRleHQiLCJ1c2VyIiwiZ2V0VXNlciIsInVzZXJuYW1lIiwicGF0aCIsImZvckVhY2giLCJpc0Rpc2FibGVkIiwidW5pdHMiLCJuYW1lIiwiZW1haWwiLCJub3RlcyIsIiRzY29wZSIsInByb2Nlc3NGb3JtIiwibWV0aG9kIiwidXJsIiwiZGF0YVR5cGUiLCJhbGVydCIsInByb2plY3RMaXN0Iiwic2hvd0RlbGV0ZSIsImV2IiwiY29uZmlybSIsInRpdGxlIiwiY29udGVudCIsImFyaWFMYWJlbCIsIm9rIiwiY2FuY2VsIiwidGFyZ2V0RXZlbnQiLCJsb2dpbiIsImZvcm0iLCJzYXZlVG9rZW4iLCJ0b2tlbiIsImxvZ291dCIsInByb2plY3RfbmFtZSIsInByb2plY3RfZGVzY3JpcHRpb24iLCJkZWxldGVQcm9qZWN0SXRlbSIsIklEIiwicHJvamVjdFRvdGFsIiwiZ2V0UHJvamVjdExpc3QiLCJ1c2VyaWQiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInBhcnNlSnd0IiwiYmFzZTY0VXJsIiwic3BsaXQiLCJiYXNlNjQiLCJyZXBsYWNlIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsImxvY2FsU3RvcmFnZSIsImp3dFRva2VuIiwiZ2V0VG9rZW4iLCJpc0F1dGhlZCIsInBhcmFtcyIsIm5vdEV4cGlyZWQiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwiZmFjdG9yeSIsIiRxIiwicmVxdWVzdCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwic3RhdHVzIiwicmVzcG9uc2VFcnJvciIsInJlamVjdCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxjQUFBLFVBQUEsYUFBQSxhQUFBLG9CQUVBRixLQUFBRyxRQUFBLHFCQUFBLGlCQUFBLG9CQUFBLGdCQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0FELEVBQUFFLFdBQUEsR0FHQUosRUFBQUssTUFBQSxXQUNBQyxlQUFBLFNBQ0FDLGNBQUEsYUFBQUMsVUFBQSxRQUNBQyxZQUFBLFVBR0FSLEVBQUFTLEtBQUEsS0FFQUMsWUFBQSx5QkFDQUMsV0FBQSwwQkFDQUYsS0FBQSxVQUVBQyxZQUFBLG9CQUNBQyxXQUFBLGNBQ0FGLEtBQUEsYUFFQUMsWUFBQSx1QkFDQUMsV0FBQSxzQkFDQUYsS0FBQSxVQUVBQyxZQUFBLG9CQUNBQyxXQUFBLHNCQUVBRixLQUFBLFlBRUFDLFlBQUEsc0JBQ0FDLFdBQUEsS0FDQUYsS0FBQSxjQUVBQyxZQUFBLHdCQUNBQyxXQUFBLGtCQUNBRixLQUFBLGFBRUFDLFlBQUEsc0JBQ0FDLFdBQUEseUJBQ0FGLEtBQUEsVUFFQUMsWUFBQSxzQkFDQUQsS0FBQSxZQUVBQyxZQUFBLHNCQUNBQyxXQUFBLEtBQ0FGLEtBQUEsWUFFQUMsWUFBQSx3QkFDQUQsS0FBQSxZQUVBQyxZQUFBLHdCQUNBRSxXQUNBQyxXQUFBLFNDcERBbEIsSUFBQWdCLFdBQUEsYUFBQSxRQUFBLFNBQUFHLEdBUUEsUUFBQUMsR0FBQUMsR0FDQSxHQUFBQyxHQUFBRCxFQUFBQyxFQUNBQyxTQUFBQyxJQUFBRixHQUNBSCxFQUFBTSxJQUFBLHdCQUFBSCxHQUFBSSxLQUFBLFNBQUFDLEdBQ0FDLE1BSUEsUUFBQUEsS0FDQVQsRUFBQVUsSUFBQSxlQUFBSCxLQUFBLFNBQUFDLEdBQ0EsR0FBQUcsR0FBQUgsRUFBQUksSUFDQVIsU0FBQUMsSUFBQU0sR0FDQUUsRUFBQUYsWUFBQUEsSUFsQkFGLEdB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QXlDLElBQ0EyRixjQUFBLFNBQUEzRixHQU9BLE1BTkEsT0FBQUEsRUFBQTBGLE9BQ0E1RyxFQUFBZ0QsS0FBQSxVQUdBOUQsUUFBQUMsSUFBQStCLEdBRUFzRixFQUFBTSxPQUFBNUYiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdlY290b25lQXBwJywgWyduZ1JvdXRlJywgJ25nTWF0ZXJpYWwnLCAnbmdNZXNzYWdlcycsICd2YWxpZGF0aW9uLm1hdGNoJ10pO1xuXG5hcHAuY29uZmlnKFsnJG1kVGhlbWluZ1Byb3ZpZGVyJywgJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbigkbWRUaGVtaW5nUHJvdmlkZXIsICRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJGh0dHBQcm92aWRlcil7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgLy9zZXQgdGhlbWUgYW5kIGNvbG9yIHBhbGV0dGVcbiAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgICAucHJpbWFyeVBhbGV0dGUoJ2dyZWVuJylcbiAgICAgICAgLmFjY2VudFBhbGV0dGUoJ2JsdWUtZ3JleScsIHsnZGVmYXVsdCc6JzYwMCd9KVxuICAgICAgICAud2FyblBhbGV0dGUgKCdvcmFuZ2UnKTtcblxuICAgIC8vcm91dGVzIGZvciB2aWV3c1xuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jYWxjdWxhdG9yLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NhbGN1bGF0ZUN0cmwgYXMgY3RybCdcbiAgICAgICAgfSkud2hlbignL2xvZ2luJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnbG9naW5DdHJsJ1xuICAgICAgICB9KS53aGVuKCcvcmVnaXN0ZXInLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWdpc3Rlci5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjcmVhdGVBY2NvdW50Q3RybCdcbiAgICAgICAgfSkud2hlbignL2FkbWluJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvYWRtaW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWRtaW5DdHJsIGFzIGN0cmwnXG5cbiAgICAgICAgfSkud2hlbignL2FjY291bnQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9hY2NvdW50Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJydcbiAgICAgICAgfSkud2hlbignL2Rhc2hib2FyZCcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2Rhc2hib2FyZC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdkYXNoYm9hcmRDdHJsJ1xuICAgICAgICB9KS53aGVuKCcvcHJvamVjdHMnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9wcm9qZWN0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3Byb2plY3RzQ3RybCBhcyBjdHJsJ1xuICAgICAgICB9KS53aGVuKCcvYWJvdXQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9hYm91dC5odG1sJ1xuICAgICAgICB9KS53aGVuKCcvY29udGFjdCcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NvbnRhY3QuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnJ1xuICAgICAgICB9KS53aGVuKCcvcHJpdmFjeScsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3ByaXZhY3kuaHRtbCdcbiAgICAgICAgfSkud2hlbignL3NvdXJjZXMnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9zb3VyY2VzLmh0bWwnXG4gICAgICAgIH0pLm90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICAgICAgfSk7XG5cbiAgICAvLyRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2F1dGhJbnRlcmNlcHRvcicpO1xufV0pOyIsIi8qKlxuICogQURNSU5cbiAqL1xuYXBwLmNvbnRyb2xsZXIoJ2FkbWluQ3RybCcsIFsnJGh0dHAnLCBmdW5jdGlvbiggJGh0dHAgKXtcbiAgICAvLyBJTklUXG4gICAgaW5pdCgpO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHNlbGYuc3VnZ2VzdGlvbnMgPSAnJztcbiAgICBzZWxmLm1hcmtDb21wbGV0ZSA9IG1hcmtDb21wbGV0ZTtcblxuICAgIGZ1bmN0aW9uIG1hcmtDb21wbGV0ZSggc3VnZ2VzdGlvbiApIHtcbiAgICAgICAgdmFyIGlkID0gc3VnZ2VzdGlvbi5pZDtcbiAgICAgICAgY29uc29sZS5sb2coaWQpO1xuICAgICAgICAkaHR0cC5wdXQoJy9zdWdnZXN0aW9uL2NvbXBsZXRlLycgKyBpZCkudGhlbihmdW5jdGlvbiggcmVzICkge1xuICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICAkaHR0cC5nZXQoJy9zdWdnZXN0aW9uJykudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICB2YXIgc3VnZ2VzdGlvbnMgPSByZXMuZGF0YTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN1Z2dlc3Rpb25zKTtcbiAgICAgICAgICAgIHNlbGYuc3VnZ2VzdGlvbnMgPSBzdWdnZXN0aW9ucztcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbn1dKTsiLCIvKipcbiAqIEFETUlOXG4gKi9cbmFwcC5jb250cm9sbGVyKCdhZG1pbkN0cmwnLCBbJyRodHRwJywgZnVuY3Rpb24oICRodHRwICl7XG4gICAgLy8gSU5JVFxuICAgIGluaXQoKTtcblxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLnN1Z2dlc3Rpb25zID0gJyc7XG4gICAgc2VsZi5tYXJrQ29tcGxldGUgPSBtYXJrQ29tcGxldGU7XG5cbiAgICBmdW5jdGlvbiBtYXJrQ29tcGxldGUoIHN1Z2dlc3Rpb24gKSB7XG4gICAgICAgIHZhciBpZCA9IHN1Z2dlc3Rpb24uaWQ7XG4gICAgICAgIGNvbnNvbGUubG9nKGlkKTtcbiAgICAgICAgJGh0dHAucHV0KCcvc3VnZ2VzdGlvbi9jb21wbGV0ZS8nICsgaWQpLnRoZW4oZnVuY3Rpb24oIHJlcyApIHtcbiAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvc3VnZ2VzdGlvbicpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgdmFyIHN1Z2dlc3Rpb25zID0gcmVzLmRhdGE7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzdWdnZXN0aW9ucyk7XG4gICAgICAgICAgICBzZWxmLnN1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnM7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG59XSk7IiwiYXBwLmNvbnRyb2xsZXIoJ2NhbGN1bGF0ZUN0cmwnLCBbJyRodHRwJywgJyRtZERpYWxvZycsICckcm9vdFNjb3BlJywgJ2F1dGhTZXJ2aWNlJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCAkaHR0cCwgJG1kRGlhbG9nLCAkcm9vdFNjb3BlLCBhdXRoU2VydmljZSwgJGxvY2F0aW9uICkge1xuXG4gICAgLy8gQ2hlY2sgdXNlclxuICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcblxuICAgIGlmKCRyb290U2NvcGUudXNlciAmJiAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUpe1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgIH1cblxuICAgIC8vIElOSVRcbiAgICAkaHR0cC5nZXQoJy9tYXRlcmlhbHMnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBsaXN0ID0gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICBpdGVtLnByaW1hcnlfY2F0ID0gaXRlbS5wcmltYXJ5X2NhdC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgLy8gL2l0ZW0ucHJpbWFyeV9jYXQgPSBpdGVtLnByaW1hcnlfY2F0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgaXRlbS5wcmltYXJ5X2NhdC5zbGljZSgxKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIH0pO1xuICAgICAgICBzZWxmLmxpc3QgPSBsaXN0O1xuXG4gICAgfSk7XG5cbiAgICAvLyBTZWxmIGRlY1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHNlbGYubGlzdCA9ICcnO1xuICAgIHNlbGYuaXNEaXNhYmxlZCA9IGZhbHNlO1xuICAgIHNlbGYucmVzdWx0ID0gJyc7XG4gICAgc2VsZi5xdWVyeVNlYXJjaCA9IHF1ZXJ5U2VhcmNoO1xuICAgIHNlbGYuc2VsZWN0ZWRJdGVtQ2hhbmdlID0gc2VsZWN0ZWRJdGVtQ2hhbmdlO1xuICAgIHNlbGYuc2VhcmNoVGV4dENoYW5nZSAgID0gc2VhcmNoVGV4dENoYW5nZTtcbiAgICBzZWxmLm5ld1N1Z2dlc3Rpb24gPSBuZXdTdWdnZXN0aW9uO1xuICAgIHNlbGYuc3VibWl0U3VnZ2VzdGlvbiA9IHN1Ym1pdFN1Z2dlc3Rpb247XG4gICAgc2VsZi51bml0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ2xicycsXG4gICAgICAgICAgICBjb252ZXJzaW9uOiAwLjAwMDVcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ2tpbG9zJyxcbiAgICAgICAgICAgIGNvbnZlcnNpb246IDAuMDAxMTAyMzFcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ3RvbnMnLFxuICAgICAgICAgICAgY29udmVyc2lvbjogMVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnbWV0cmljIHRvbnMnLFxuICAgICAgICAgICAgY29udmVyc2lvbjogMS4xMDIzMVxuICAgICAgICB9XG4gICAgXTtcbiAgICBzZWxmLnN1Ym1pc3Npb24gPSB7XG4gICAgICAgIGVtYWlsOiAnJyxcbiAgICAgICAgbWF0ZXJpYWw6ICcnLFxuICAgICAgICBub3RlczogJydcbiAgICB9O1xuICAgIHNlbGYubmV3Q2FsY3VsYXRpb24gPSBuZXdDYWxjdWxhdGlvbjtcblxuXG4gICAgZnVuY3Rpb24gc2VhcmNoVGV4dENoYW5nZSh0ZXh0KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUZXh0IGNoYW5nZWQgdG8gJywgdGV4dCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2VsZWN0ZWRJdGVtQ2hhbmdlKGl0ZW0pIHtcbiAgICAgICAgaWYgKCBpdGVtID09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgIHNlbGYuY2F0ZWdvcnkgPSAnJztcbiAgICAgICAgICAgIHNlbGYuc3ViY2F0ZWdvcnkgPSAnJztcbiAgICAgICAgICAgIHNlbGYud2FybUlkID0gJyc7XG4gICAgICAgICAgICBzZWxmLndlaWdodCA9ICcnO1xuICAgICAgICAgICAgc2VsZi5jb252ZXJzaW9uID0gJyc7XG4gICAgICAgICAgICBzZWxmLnJlc3VsdCA9ICcnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbmV3Q2FsY3VsYXRpb24oKSB7XG5cbiAgICAgICAgdmFyIGNhbGN1bGF0ZSA9IHtcbiAgICAgICAgICAgIHdhcm1JZDogc2VsZi53YXJtSWQgfHwgc2VsZi5jYXRlZ29yeS5zZWNvbmRhcmllc1swXS53YXJtX2lkLFxuICAgICAgICAgICAgd2VpZ2h0OiBwYXJzZUZsb2F0KHNlbGYud2VpZ2h0KSAqIHNlbGYuY29udmVyc2lvblxuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLnBvc3QoJy9jYWxjdWxhdGlvbnMnLCBjYWxjdWxhdGUpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHNlbGYucmVzdWx0ID0gTWF0aC5mbG9vcihNYXRoLmFicyhyZXNwb25zZS5kYXRhKSAqIDEwMDApIC8gMTAwMDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2F2ZVRvUHJvamVjdCgpe1xuICAgICAgICB2YXIgbGluZUl0ZW0gPSB7XG4gICAgICAgICAgICBjYXRlZ29yeTogc2VsZi5jYXRlZ29yeSxcbiAgICAgICAgICAgIHN1YmNhdGVnb3J5OiBzZWxmLnN1YmNhdGVnb3J5LFxuICAgICAgICAgICAgd2FybV9JZDogc2VsZi53YXJtSWQsXG4gICAgICAgICAgICB3ZWlnaHQ6IHBhcnNlRmxvYXQoc2VsZi53ZWlnaHQpKnNlbGYuY29udmVyc2lvbixcbiAgICAgICAgICAgIHVuaXRzOiBzZWxmLnVuaXQubmFtZVxuICAgICAgICB9O1xuICAgICAgICBjb25zb2xlLmxvZyhsaW5lSXRlbSk7XG4gICAgICAgICRodHRwLnBvc3QoJy9hZGRUb1Byb2plY3QnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHF1ZXJ5U2VhcmNoKHF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiBxdWVyeSA/IHNlbGYubGlzdC5maWx0ZXIoY3JlYXRlRmlsdGVyRm9yKHF1ZXJ5KSkgOiBzZWxmLmxpc3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlRmlsdGVyRm9yKHF1ZXJ5KSB7XG4gICAgICAgIHZhciBsb3dlcmNhc2VRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIC8vcXVlcnkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBxdWVyeS5zbGljZSgxKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZpbHRlckZuKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIChvYmoucHJpbWFyeV9jYXQuaW5kZXhPZihsb3dlcmNhc2VRdWVyeSkgIT0gLTEpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN1Ym1pdFN1Z2dlc3Rpb24oKXtcbiAgICAgICAgJGh0dHAucG9zdCgnL3N1Z2dlc3Rpb24nLCBzZWxmLnN1Ym1pc3Npb24pLnRoZW4oZnVuY3Rpb24oIHJlcyApe1xuICAgICAgICAgICAgJG1kRGlhbG9nLmhpZGUoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbmV3U3VnZ2VzdGlvbiggc3VnZ2VzdGlvbiApe1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZW5hdicpLmZvY3VzKCk7XG5cbiAgICAgICAgJG1kRGlhbG9nLnNob3coe1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3Mvc3VibWl0LW1vZGFsLmh0bWwnLFxuICAgICAgICAgICAgY2xpY2tPdXRzaWRlVG9DbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjYWxjdWxhdGVDdHJsJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2N0cmwnLFxuICAgICAgICAgICAgbG9jYWxzOiB7bWF0ZXJpYWw6IHNlbGYuc2VhcmNoVGV4dH1cbiAgICAgICAgfSlcblxuICAgIH1cblxuXG59XSk7IiwiLy8gUmVnaXN0ZXIgSFRNTCAtIE1hZGVsaW5lXG5hcHAuY29udHJvbGxlcignY3JlYXRlQWNjb3VudEN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsICckbG9jYXRpb24nLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkbG9jYXRpb24pIHtcbiAgICAkc2NvcGUudXNlciA9IHt9O1xuXG4gICAgJHNjb3BlLnByb2Nlc3NGb3JtID0gZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJQb3N0aW5nLi4uXCIpO1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJy9yZWdpc3RlcicsXG4gICAgICAgICAgICBkYXRhOiAkc2NvcGUudXNlcixcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcbiAgICAgICAgICAgIGFsZXJ0KFwiWW91ciBhY2NvdW50IGhhcyBiZWVuIGNyZWF0ZWQuXCIpXG4gICAgICAgIH0pXG4gICAgfTtcbn1dKTsiLCJhcHAuY29udHJvbGxlcignZGFzaGJvYXJkQ3RybCcsIFsnJG1kRGlhbG9nJywgJyRzY29wZScsICckaHR0cCcsIGZ1bmN0aW9uKCRtZERpYWxvZywgJHNjb3BlLCAkaHR0cCkge1xuICAgIC8vbG9hZCBwcm9qZWN0IGxpc3Qgb24gcGFnZSBsb2FkXG4gICAgJGh0dHAuZ2V0KCcvcHJvamVjdCcpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAkc2NvcGUucHJvamVjdExpc3QgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAvL3Jlc3BvbnNlLmRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgLy8gICAgaXRlbS5wcm9qZWN0X25hbWUgPSBpdGVtLnByaW1hcnlfY2F0LnRvTG93ZXJDYXNlKCk7XG4gICAgfSk7XG4vL3RoaXMgaXMgZm9yIHRoZSBkZWxldGUgbW9kYWwgYWxlcnQgZm9yIGRlbGV0aW5nIGEgcHJvamVjdC0tIHN0aWxsIG5vdCB3b3JraW5nIGNvcnJlY3RcblxuICAgICRzY29wZS5zaG93RGVsZXRlID0gZnVuY3Rpb24oZXYpIHtcblxuICAgICAgICBjb25zb2xlLmxvZygnQ0xJQ0snKTtcbiAgICAgICAgdmFyIGNvbmZpcm0gPSAkbWREaWFsb2cuY29uZmlybSgpXG4gICAgICAgICAgICAudGl0bGUoJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgeW91ciBwcm9qZWN0PycpXG4gICAgICAgICAgICAuY29udGVudCgnVGhpcyBpcyBwZXJtYW5lbnQuJylcbiAgICAgICAgICAgIC5hcmlhTGFiZWwoJ0RlbGV0ZSBwcm9qZWN0IHBlcm1hbmVudGx5JylcbiAgICAgICAgICAgIC5vaygnRGVsZXRlJylcbiAgICAgICAgICAgIC5jYW5jZWwoJ0NhbmNlbCcpXG4gICAgICAgICAgICAudGFyZ2V0RXZlbnQoZXYpO1xuICAgICAgICAkbWREaWFsb2cuc2hvdyhjb25maXJtKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLmFsZXJ0ID0gJ1lvdXIgcHJvamVjdCBoYXMgYmVlbiBkZWxldGVkLic7XG4gICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNjb3BlLmFsZXJ0ID0gJ1lvdXIgcHJvamVjdCBoYXMgbm90IGJlZW4gZGVsZXRlZC4nO1xuICAgICAgICB9KTtcbiAgICB9O1xuLy8gICAgZnVuY3Rpb24gRGlhbG9nQ29udHJvbGxlcigkc2NvcGUsICRtZERpYWxvZykge1xuLy8gICAgJHNjb3BlLmhpZGUgPSBmdW5jdGlvbigpIHtcbi8vICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuLy8gICAgfTtcbi8vICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbigpIHtcbi8vICAgICAgICAkbWREaWFsb2cuY2FuY2VsKCk7XG4vLyAgICB9O1xuLy8gICAgJHNjb3BlLmFuc3dlciA9IGZ1bmN0aW9uKGFuc3dlcikge1xuLy8gICAgICAgICRtZERpYWxvZy5oaWRlKGFuc3dlcik7XG4vLyAgICB9O1xuLy99XG5cbn1dKTsiLCIvLyBMb2dpbiBIVE1MIC0gS2F0ZVxuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgJ2F1dGhTZXJ2aWNlJywgJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgYXV0aFNlcnZpY2UsICRsb2NhdGlvbiwgJHJvb3RTY29wZSkge1xuICAgICRzY29wZS5sb2dpbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICcvbG9naW4nLFxuICAgICAgICAgICAgZGF0YTogJHNjb3BlLmZvcm1cbiAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICBhdXRoU2VydmljZS5zYXZlVG9rZW4ocmVzcG9uc2UuZGF0YS50b2tlbik7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgICAgICB9KVxuICAgIH1cbn1dKTsiLCIvLyBDaGFuZ2UgTmF2aWdhdGlvbiBPcHRpb25zIHdpdGggTG9naW5cbmFwcC5jb250cm9sbGVyKCduYXZDdHJsJywgWydhdXRoU2VydmljZScsICckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCBmdW5jdGlvbihhdXRoU2VydmljZSwgJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRodHRwKXtcbiAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG5cbiAgICBpZigkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9XG5cbiAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgYXV0aFNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9XG59XSk7XG4iLCIvLyBQcm9qZWN0IFBhZ2UgLSAgS2ltL01hZGVsZWluZVxuYXBwLmNvbnRyb2xsZXIoJ3Byb2plY3RzQ3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCkge1xuXG4gICAgLy8gU2VsZiBkZWNcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5wcm9qZWN0TGlzdCA9ICcnO1xuICAgIHNlbGYucmVzdWx0ID0gJyc7XG4gICAgc2VsZi5xdWVyeVNlYXJjaCA9IHF1ZXJ5U2VhcmNoO1xuICAgIHNlbGYuc2VsZWN0ZWRJdGVtQ2hhbmdlID0gc2VsZWN0ZWRJdGVtQ2hhbmdlO1xuICAgIHNlbGYuc2VhcmNoVGV4dENoYW5nZSA9IHNlYXJjaFRleHRDaGFuZ2U7XG4gICAgc2VsZi5wcm9qZWN0VG90YWw9IDA7XG4gICAgc2VsZi5kZWxldGVQcm9qZWN0SXRlbSA9IGRlbGV0ZVByb2plY3RJdGVtO1xuICAgIHNlbGYuaWQgPSAwO1xuXG5cbiAgICAvL2xvYWQgcHJvamVjdCBsaXN0IG9uIHBhZ2UgbG9hZFxuICAgIHNlbGYuZ2V0UHJvamVjdExpc3QgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgLy9uZWVkIHRvIGZpZ3VyZSBvdXQgaG93IHRvIHBhc3MgdGhlIHVzZXJpZCBmcm9tIHRoZSBsb2dpbiBwYWdlLS11c2UgdGhlIHNhbWUgY29udHJvbGxlcj9cbiAgICAgICAgJGh0dHAuZ2V0KCcvcHJvamVjdCcsIHVzZXJpZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHZhciBwcm9qZWN0TGlzdCA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgICAgICBwcm9qZWN0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgcHJvamVjdF9uYW1lID0gaXRlbS5wcm9qZWN0X25hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICBwcm9qZWN0X2Rlc2NyaXB0aW9uID0gaXRlbS5wcm9qZWN0X2Rlc2NyaXB0aW9uO1xuICAgICAgICAgICAgICAgIGlkID0gaXRlbS5pZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2VsZi5wcm9qZWN0TGlzdCA9IHByb2plY3RMaXN0O1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gcXVlcnlTZWFyY2gocXVlcnkpIHtcbiAgICAgICAgcmV0dXJuIHF1ZXJ5ID8gc2VsZi5wcm9qZWN0TGlzdC5maWx0ZXIoY3JlYXRlRmlsdGVyRm9yKHF1ZXJ5KSkgOiBzZWxmLnByb2plY3RMaXN0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUZpbHRlckZvcihxdWVyeSkge1xuICAgICAgICB2YXIgbG93ZXJjYXNlUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAvL3F1ZXJ5LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcXVlcnkuc2xpY2UoMSk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBmaWx0ZXJGbihvYmopIHtcbiAgICAgICAgICAgIHJldHVybiAob2JqLnByaW1hcnlfY2F0LmluZGV4T2YobG93ZXJjYXNlUXVlcnkpICE9IC0xKTtcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZWFyY2hUZXh0Q2hhbmdlKHRleHQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1RleHQgY2hhbmdlZCB0byAnLCB0ZXh0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZWxlY3RlZEl0ZW1DaGFuZ2UoaXRlbSkge1xuICAgICAgICBpZiAoIGl0ZW0gPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgc2VsZi5wcm9qZWN0X25hbWUgPSAnJztcbiAgICAgICAgICAgIHNlbGYucHJvamVjdF9kZXNjcmlwdGlvbiA9ICcnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZGVsZXRlUHJvamVjdEl0ZW0oKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRGVsZXRpbmcuLi5cIiwgc2VsZi5wcm9qZWN0TGlzdC5JRCk7XG4gICAgICAgIC8vJGh0dHAudXBkYXRlKCcvcHJvamVjdCcpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIC8vZmluZE9uZSBhbmQgZGVsZXRlIGJ5IGlkIHVzaW5nIHByb2plY3RsaXN0LmlkXG4gICAgICAgIC8vICAgIGNvbnNvbGUubG9nKFwiSXRlbSB3YXMgZGVsZXRlZC5cIiwgcmVzcG9uc2UpO1xuICAgICAgICAvLyAgICBzZWxmLmdldFByb2plY3RMaXN0KCk7XG4gICAgfTtcblxuICAgIC8vc2VsZi5jYWxjdWxhdGVQcm9qZWN0VG90YWwoKXtcbiAgICAvLy8vZm9yRWFjaCBwcm9qZWN0XG4gICAgLy8gICAgdmFyIHByb2plY3RUb3RhbCs9cHJvamVjdExpc3QuY28yX29mZnNldDtcbiAgICAvLyAgICByZXR1cm4gcHJvamVjdFRvdGFsO1xuICAgIC8vfVxuICAgIC8vfTtcbn1dKTsiLCIvLyBTZXJ2aWNlcyBmb3IgYXV0aGVudGljYXRpb25cbmFwcC5zZXJ2aWNlKCdhdXRoU2VydmljZScsIFsnJHdpbmRvdycsIGZ1bmN0aW9uICgkd2luZG93KXtcbiAgICB0aGlzLnBhcnNlSnd0ID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xuICAgICAgICB9IGVsc2UgcmV0dXJuIHt9O1xuICAgIH07XG5cbiAgICB0aGlzLnNhdmVUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IHRva2VuO1xuICAgICAgICBjb25zb2xlLmxvZygnU2F2ZWQgdG9rZW46Jywkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbik7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB0aGlzLnBhcnNlSnd0KHRva2VuKTtcbiAgICAgICAgICAgIHZhciBub3RFeHBpcmVkID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIDw9IHBhcmFtcy5leHA7XG4gICAgICAgICAgICBpZiAoIW5vdEV4cGlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vdEV4cGlyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgLy8gZXhwb3NlIHVzZXIgYXMgYW4gb2JqZWN0XG4gICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUp3dCh0aGlzLmdldFRva2VuKCkpXG4gICAgfTtcbn1dKTtcblxuYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XG4gICAgICAgIH0sIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9O1xufV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
