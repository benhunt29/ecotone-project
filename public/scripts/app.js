var app=angular.module("ecotoneApp",["ngRoute","ngMaterial","ngMessages"]);app.config(["$mdThemingProvider","$routeProvider","$locationProvider","$httpProvider",function(e,t,o,r){o.html5Mode(!0),e.theme("default").primaryPalette("green").accentPalette("blue-grey",{"default":"600"}).warnPalette("orange"),t.when("/",{templateUrl:"/views/calculator.html",controller:"calculateCtrl"}).when("/login",{templateUrl:"/views/login.html",controller:""}).when("/register",{templateUrl:"/views/register.html",controller:"createAccountCtrl"}).when("/account",{templateUrl:"/views/account.html",controller:""}).when("/dashboard",{templateUrl:"/views/dashboard.html",controller:"projectsCtrl"}).when("/projects",{templateUrl:"/views/project.html",controller:"projectsCtrl"}).when("/about",{templateUrl:"/views/about.html"}).when("/contact",{templateUrl:"/views/contact.html",controller:""}).when("/privacy",{templateUrl:"/views/privacy.html"}).otherwise({redirectTo:"/"})}]),app.controller("calculateCtrl",["$scope","$http",function(e,t){function o(e){var t=angular.lowercase(e);return function(e){return-1!=e.primary_cat.indexOf(t)}}e.saveToProject=function(){var o={category:e.category,subcategory:e.subcategory,warm_Id:e.warmId,weight:parseFloat(e.weight)*e.conversion,units:e.unit.name};console.log(o),t.post("/addToProject").then(function(e){console.log(e)})},e.newCalculation=function(){console.log("Calculating...",e.weight);var o={warmId:e.warmId||e.category.secondaries[0].warm_id,weight:parseFloat(e.weight)*e.conversion};console.log(o),t.post("/calculations",o).then(function(t){console.log(t),e.result=Math.abs(t.data)})},e.querySearch=function(t){return console.log(e.list.filter(o(t))),t?e.list.filter(o(t)):e.list},t.get("/materials").then(function(t){console.log(t),e.list=t.data,t.data.forEach(function(e){e.primary_cat=e.primary_cat.toLowerCase(),e.primary_cat=e.primary_cat.charAt(0).toUpperCase()+e.primary_cat.slice(1)})}),e.units=[{name:"lbs",conversion:5e-4},{name:"kilos",conversion:.00110231},{name:"tons",conversion:1},{name:"metric tons",conversion:1.10231}]}]),app.controller("loginCtrl",["$scope","$http","authService",function(e,t,o){e.login=function(){t({method:"POST",url:"/login",data:e.user}).then(function(e){o.saveToken(e.data.token)})}}]),app.controller("createAccountCtrl",["$scope","$http",function(e,t){e.user={},e.processForm=function(o){console.log("Posting..."),t({method:"POST",url:"/register",data:e.user,dataType:"json"}).then(function(e){console.log(e),alert("Your account has been created.")})}}]),app.controller("projectsCtrl",["$scope","$http",function(e,t){t({method:"POST",url:"http://www.w3schools.com/angular/customers.php"}).then(function(t){e.names=t.records})}]),app.service("authService",["$window",function(e){this.parseJwt=function(t){if(t){var o=t.split(".")[1],r=o.replace("-","+").replace("_","/");return JSON.parse(e.atob(r))}return{}},this.saveToken=function(t){e.localStorage.jwtToken=t,console.log("Saved token:",e.localStorage.jwtToken)},this.getToken=function(){return e.localStorage.jwtToken},this.isAuthed=function(){var e=this.getToken();if(e){var t=this.parseJwt(e),o=Math.round((new Date).getTime()/1e3)<=t.exp;return o||this.logout(),o}return!1},this.logout=function(){delete e.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(e,t,o){return{request:function(e){return e.headers=e.headers||{},o.isAuthed()&&(e.headers.Authorization="Bearer "+o.getToken()),e},response:function(o){return 401===o.status&&t.path("/login"),o||e.when(o)},responseError:function(o){return 401===o.status?t.path("/login"):console.log(o),e.reject(o)}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvYXBwLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImh0bWw1TW9kZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiZGVmYXVsdCIsIndhcm5QYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCIkc2NvcGUiLCIkaHR0cCIsImNyZWF0ZUZpbHRlckZvciIsInF1ZXJ5IiwibG93ZXJjYXNlUXVlcnkiLCJsb3dlcmNhc2UiLCJvYmoiLCJwcmltYXJ5X2NhdCIsImluZGV4T2YiLCJzYXZlVG9Qcm9qZWN0IiwibGluZUl0ZW0iLCJjYXRlZ29yeSIsInN1YmNhdGVnb3J5Iiwid2FybV9JZCIsIndhcm1JZCIsIndlaWdodCIsInBhcnNlRmxvYXQiLCJjb252ZXJzaW9uIiwidW5pdHMiLCJ1bml0IiwibmFtZSIsImNvbnNvbGUiLCJsb2ciLCJwb3N0IiwidGhlbiIsInJlc3BvbnNlIiwibmV3Q2FsY3VsYXRpb24iLCJjYWxjdWxhdGUiLCJzZWNvbmRhcmllcyIsIndhcm1faWQiLCJyZXN1bHQiLCJNYXRoIiwiYWJzIiwiZGF0YSIsInF1ZXJ5U2VhcmNoIiwibGlzdCIsImZpbHRlciIsImdldCIsImZvckVhY2giLCJpdGVtIiwidG9Mb3dlckNhc2UiLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwiYXV0aFNlcnZpY2UiLCJsb2dpbiIsIm1ldGhvZCIsInVybCIsInVzZXIiLCJzYXZlVG9rZW4iLCJ0b2tlbiIsInByb2Nlc3NGb3JtIiwiZGF0YVR5cGUiLCJhbGVydCIsIm5hbWVzIiwicmVjb3JkcyIsInNlcnZpY2UiLCIkd2luZG93IiwidGhpcyIsInBhcnNlSnd0IiwiYmFzZTY0VXJsIiwic3BsaXQiLCJiYXNlNjQiLCJyZXBsYWNlIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsImxvY2FsU3RvcmFnZSIsImp3dFRva2VuIiwiZ2V0VG9rZW4iLCJpc0F1dGhlZCIsInBhcmFtcyIsIm5vdEV4cGlyZWQiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwibG9nb3V0IiwiZ2V0VXNlciIsImZhY3RvcnkiLCIkcSIsIiRsb2NhdGlvbiIsInJlcXVlc3QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsInN0YXR1cyIsInBhdGgiLCJyZXNwb25zZUVycm9yIiwicmVqZWN0Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFJQSxLQUFNQyxRQUFRQyxPQUFPLGNBQWUsVUFBVyxhQUFjLGNBRWpFRixLQUFJRyxRQUFRLHFCQUFzQixpQkFBa0Isb0JBQXFCLGdCQUFpQixTQUFTQyxFQUFvQkMsRUFBZ0JDLEVBQW1CQyxHQUN0SkQsRUFBa0JFLFdBQVUsR0FHNUJKLEVBQW1CSyxNQUFNLFdBQ3BCQyxlQUFlLFNBQ2ZDLGNBQWMsYUFBY0MsVUFBVSxRQUN0Q0MsWUFBYSxVQUdsQlIsRUFBZVMsS0FBSyxLQUVaQyxZQUFhLHlCQUNiQyxXQUFZLGtCQUNiRixLQUFLLFVBRUpDLFlBQWEsb0JBQ2JDLFdBQVksS0FDYkYsS0FBSyxhQUVKQyxZQUFhLHVCQUNiQyxXQUFZLHNCQUNiRixLQUFLLFlBRUpDLFlBQWEsc0JBQ2JDLFdBQVksS0FDYkYsS0FBSyxjQUVKQyxZQUFhLHdCQUNiQyxXQUFZLGlCQUNiRixLQUFLLGFBRUpDLFlBQWEsc0JBQ2JDLFdBQVksaUJBQ2JGLEtBQUssVUFFSkMsWUFBYSxzQkFDZEQsS0FBSyxZQUVKQyxZQUFhLHNCQUNiQyxXQUFZLEtBQ2JGLEtBQUssWUFFSkMsWUFBYSx3QkFDZEUsV0FDQ0MsV0FBWSxTQU94QmxCLElBQUlnQixXQUFXLGlCQUFrQixTQUFVLFFBQVMsU0FBU0csRUFBUUMsR0FvRWpFLFFBQVNDLEdBQWdCQyxHQUNyQixHQUFJQyxHQUFpQnRCLFFB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QixRQUFRQyxJQUFJLGVBQWVtQyxFQUFRVSxhQUFhQyxXQUdwRFYsS0FBS1csU0FBVyxXQUNaLE1BQU9aLEdBQVFVLGFBQWFDLFVBR2hDVixLQUFLWSxTQUFXLFdBQ1osR0FBSXBCLEdBQVFRLEtBQUtXLFVBQ2pCLElBQUluQixFQUFPLENBQ1AsR0FBSXFCLEdBQVNiLEtBQUtDLFNBQVNULEdBQ3ZCc0IsRUFBYXpDLEtBQUswQyxPQUFNLEdBQUlDLE9BQU9DLFVBQVksTUFBU0osRUFBT0ssR0FJbkUsT0FIS0osSUFDRGQsS0FBS21CLFNBRUZMLEVBRVAsT0FBTyxHQUlmZCxLQUFLbUIsT0FBUyxpQkFDSHBCLEdBQVFVLGFBQWFDLFVBSWhDVixLQUFLb0IsUUFBVSxXQUNYLE1BQU9wQixNQUFLQyxTQUFTRCxLQUFLVyxnQkFJbEN4RixJQUFJa0csUUFBUSxtQkFBb0IsS0FBTSxZQUFhLGNBQWUsU0FBVUMsRUFBSUMsRUFBV3JDLEdBQ3ZGLE9BQ0lzQyxRQUFTLFNBQVVsRyxHQUtmLE1BSkFBLEdBQU9tRyxRQUFVbkcsRUFBT21HLFlBQ3BCdkMsRUFBWTBCLGFBQ1p0RixFQUFPbUcsUUFBUUMsY0FBZ0IsVUFBWXhDLEVBQVl5QixZQUVwRHJGLEdBRVh5QyxTQUFVLFNBQVVBLEdBT2hCLE1BTHdCLE9BQXBCQSxFQUFTNEQsUUFHVEosRUFBVUssS0FBSyxVQUVaN0QsR0FBWXVELEVBQUdyRixLQUFLOEIsSUFDNUI4RCxjQUFlLFNBQVU5RCxHQU94QixNQU53QixPQUFwQkEsRUFBUzRELE9BQ1RKLEVBQVVLLEtBQUssVUFHZmpFLFFBQVFDLElBQUlHLEdBRVR1RCxFQUFHUSxPQUFPL0QiLCJmaWxlIjoic2NyaXB0cy9hcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2Vjb3RvbmVBcHAnLCBbJ25nUm91dGUnLCAnbmdNYXRlcmlhbCcsICduZ01lc3NhZ2VzJ10pO1xuXG5hcHAuY29uZmlnKFsnJG1kVGhlbWluZ1Byb3ZpZGVyJywgJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbigkbWRUaGVtaW5nUHJvdmlkZXIsICRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJGh0dHBQcm92aWRlcil7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgLy9zZXQgdGhlbWUgYW5kIGNvbG9yIHBhbGV0dGVcbiAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgICAucHJpbWFyeVBhbGV0dGUoJ2dyZWVuJylcbiAgICAgICAgLmFjY2VudFBhbGV0dGUoJ2JsdWUtZ3JleScsIHsnZGVmYXVsdCc6JzYwMCd9KVxuICAgICAgICAud2FyblBhbGV0dGUgKCdvcmFuZ2UnKTtcblxuICAgIC8vcm91dGVzIGZvciB2aWV3c1xuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jYWxjdWxhdG9yLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NhbGN1bGF0ZUN0cmwnXG4gICAgICAgIH0pLndoZW4oJy9sb2dpbicsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2xvZ2luLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJydcbiAgICAgICAgfSkud2hlbignL3JlZ2lzdGVyJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVnaXN0ZXIuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY3JlYXRlQWNjb3VudEN0cmwnXG4gICAgICAgIH0pLndoZW4oJy9hY2NvdW50JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvYWNjb3VudC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICcnXG4gICAgICAgIH0pLndoZW4oJy9kYXNoYm9hcmQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9kYXNoYm9hcmQuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncHJvamVjdHNDdHJsJ1xuICAgICAgICB9KS53aGVuKCcvcHJvamVjdHMnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9wcm9qZWN0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3Byb2plY3RzQ3RybCdcbiAgICAgICAgfSkud2hlbignL2Fib3V0JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvYWJvdXQuaHRtbCdcbiAgICAgICAgfSkud2hlbignL2NvbnRhY3QnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jb250YWN0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJydcbiAgICAgICAgfSkud2hlbignL3ByaXZhY3knLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9wcml2YWN5Lmh0bWwnXG4gICAgICAgIH0pLm90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICAgICAgfSk7XG5cbiAgICAvLyRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2F1dGhJbnRlcmNlcHRvcicpO1xufV0pO1xuXG4gICAgLy9NLy9kZXNpZ25hdGUgY29udHJvbGxlclxuYXBwLmNvbnRyb2xsZXIoJ2NhbGN1bGF0ZUN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcbi8vIGNyZWF0ZSBvYmplY3QgdG8gc2VuZCB0byBiYWNrZW5kIGZvciBjYWxjdWxhdGlvblxuXG4gICAgJHNjb3BlLnNhdmVUb1Byb2plY3QgPSBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgbGluZUl0ZW0gPSB7XG4gICAgICAgICAgICBjYXRlZ29yeTogJHNjb3BlLmNhdGVnb3J5LFxuICAgICAgICAgICAgc3ViY2F0ZWdvcnk6ICRzY29wZS5zdWJjYXRlZ29yeSxcbiAgICAgICAgICAgIHdhcm1fSWQ6ICRzY29wZS53YXJtSWQsXG4gICAgICAgICAgICB3ZWlnaHQ6IHBhcnNlRmxvYXQoJHNjb3BlLndlaWdodCkqJHNjb3BlLmNvbnZlcnNpb24sXG4gICAgICAgICAgICB1bml0czogJHNjb3BlLnVuaXQubmFtZVxuICAgICAgICB9O1xuICAgICAgICBjb25zb2xlLmxvZyhsaW5lSXRlbSk7XG4gICAgICAgICRodHRwLnBvc3QoJy9hZGRUb1Byb2plY3QnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICRzY29wZS5uZXdDYWxjdWxhdGlvbiA9IGZ1bmN0aW9uKCl7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ2FsY3VsYXRpbmcuLi5cIiwgJHNjb3BlLndlaWdodCk7XG4gICAgICAgIHZhciBjYWxjdWxhdGUgPSB7XG4gICAgICAgICAgICB3YXJtSWQ6ICRzY29wZS53YXJtSWQgfHwgJHNjb3BlLmNhdGVnb3J5LnNlY29uZGFyaWVzWzBdLndhcm1faWQsXG4gICAgICAgICAgICB3ZWlnaHQ6IHBhcnNlRmxvYXQoJHNjb3BlLndlaWdodCkqJHNjb3BlLmNvbnZlcnNpb25cbiAgICAgICAgfTtcbiAgICAgICAgY29uc29sZS5sb2coY2FsY3VsYXRlKTtcbiAgICAgICAgJGh0dHAucG9zdCgnL2NhbGN1bGF0aW9ucycsIGNhbGN1bGF0ZSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgJHNjb3BlLnJlc3VsdCA9IE1hdGguYWJzKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4vL2F1dG9jb21wbGV0ZSBmdW5jdGlvbmFsaXR5XG4gICAgJHNjb3BlLnF1ZXJ5U2VhcmNoPWZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCRzY29wZS5saXN0LmZpbHRlcihjcmVhdGVGaWx0ZXJGb3IocXVlcnkpKSk7XG4gICAgICAgIHJldHVybiBxdWVyeSA/ICRzY29wZS5saXN0LmZpbHRlcihjcmVhdGVGaWx0ZXJGb3IocXVlcnkpKSA6ICRzY29wZS5saXN0O1xuICAgIH07XG5cbi8vbG9hZCBQcmltYXJ5IGNhdGVnb3JpZXMgbGlzdCBvbiBwYWdlIGxvYWRcbiAgICAkaHR0cC5nZXQoJy9tYXRlcmlhbHMnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgJHNjb3BlLmxpc3QgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICByZXNwb25zZS5kYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICBpdGVtLnByaW1hcnlfY2F0ID0gaXRlbS5wcmltYXJ5X2NhdC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgaXRlbS5wcmltYXJ5X2NhdCA9IGl0ZW0ucHJpbWFyeV9jYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBpdGVtLnByaW1hcnlfY2F0LnNsaWNlKDEpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuLy9sb2FkIHRoZSB1bml0c1xuICAgICRzY29wZS51bml0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ2xicycsXG4gICAgICAgICAgICBjb252ZXJzaW9uOiAwLjAwMDVcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ2tpbG9zJyxcbiAgICAgICAgICAgIGNvbnZlcnNpb246IDAuMDAxMTAyMzFcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ3RvbnMnLFxuICAgICAgICAgICAgY29udmVyc2lvbjogMVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnbWV0cmljIHRvbnMnLFxuICAgICAgICAgICAgY29udmVyc2lvbjogMS4xMDIzMVxuICAgICAgICB9XG4gICAgXTtcbi8vXG5cbi8vQ3JlYXRlIGZpbHRlciBmdW5jdGlvbiBmb3IgYSBxdWVyeSBzdHJpbmdcbiAgICBmdW5jdGlvbiBjcmVhdGVGaWx0ZXJGb3IocXVlcnkpIHtcbiAgICAgICAgdmFyIGxvd2VyY2FzZVF1ZXJ5ID0gYW5ndWxhci5sb3dlcmNhc2UocXVlcnkpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKHF1ZXJ5KTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZpbHRlckZuKG9iaikge1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhvYmoucHJpbWFyeV9jYXQpO1xuICAgICAgICAgICAgcmV0dXJuIChvYmoucHJpbWFyeV9jYXQuaW5kZXhPZihsb3dlcmNhc2VRdWVyeSkgIT0gLTEpO1xuICAgICAgICB9O1xuICAgIH1cbn1dKTtcblxuXG4vLyBMb2dpbiBIVE1MIC0gS2F0ZVxuYXBwLmNvbnRyb2xsZXIoJ2xvZ2luQ3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgYXV0aFNlcnZpY2UpIHtcbiAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcbiAgICAgICAgICAgIGRhdGE6ICRzY29wZS51c2VyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgYXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xuICAgICAgICB9KVxuICAgIH1cbn1dKTtcblxuLy8gUmVnaXN0ZXIgSFRNTCAtIE1hZGVsaW5lXG5hcHAuY29udHJvbGxlcignY3JlYXRlQWNjb3VudEN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcbiAgICAkc2NvcGUudXNlciA9IHt9O1xuXG4gICAgJHNjb3BlLnByb2Nlc3NGb3JtID0gZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJQb3N0aW5nLi4uXCIpO1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJy9yZWdpc3RlcicsXG4gICAgICAgICAgICBkYXRhOiAkc2NvcGUudXNlcixcbiAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGFsZXJ0KFwiWW91ciBhY2NvdW50IGhhcyBiZWVuIGNyZWF0ZWQuXCIpXG4gICAgICAgIH0pXG4gICAgfTtcbn1dKTtcblxuLy8gUHJvamVjdCBIVE1MIC0gRGFzaGJvYXJkIEhUTUwgLSBLaW1cbmFwcC5jb250cm9sbGVyKCdwcm9qZWN0c0N0cmwnLCBbJyRzY29wZScsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcbiAgICAkaHR0cCh7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICB1cmw6ICdodHRwOi8vd3d3Lnczc2Nob29scy5jb20vYW5ndWxhci9jdXN0b21lcnMucGhwJ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICRzY29wZS5uYW1lcyA9IHJlc3BvbnNlLnJlY29yZHM7XG4gICAgfSk7XG5cblxufV0pO1xuXG4vLyBTZXJ2aWNlcyBmb3IgYXV0aGVudGljYXRpb25cbmFwcC5zZXJ2aWNlKCdhdXRoU2VydmljZScsIFsnJHdpbmRvdycsIGZ1bmN0aW9uICgkd2luZG93KXtcbiAgICB0aGlzLnBhcnNlSnd0ID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xuICAgICAgICB9IGVsc2UgcmV0dXJuIHt9O1xuICAgIH07XG5cbiAgICB0aGlzLnNhdmVUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IHRva2VuO1xuICAgICAgICBjb25zb2xlLmxvZygnU2F2ZWQgdG9rZW46Jywkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbik7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB0aGlzLnBhcnNlSnd0KHRva2VuKTtcbiAgICAgICAgICAgIHZhciBub3RFeHBpcmVkID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIDw9IHBhcmFtcy5leHA7XG4gICAgICAgICAgICBpZiAoIW5vdEV4cGlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vdEV4cGlyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgLy8gZXhwb3NlIHVzZXIgYXMgYW4gb2JqZWN0XG4gICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUp3dCh0aGlzLmdldFRva2VuKCkpXG4gICAgfTtcbn1dKTtcblxuYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XG4gICAgICAgIH0sIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9O1xufV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
