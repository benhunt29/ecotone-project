var app=angular.module("ecotoneApp",["ngRoute","ngMaterial","ngMessages","validation.match"]);app.config(["$mdThemingProvider","$routeProvider","$locationProvider","$httpProvider",function(t,e,o,n){o.html5Mode(!0),t.theme("default").primaryPalette("green").accentPalette("blue-grey",{"default":"600"}).warnPalette("orange"),e.when("/",{templateUrl:"/views/calculator.html",controller:"calculateCtrl as ctrl"}).when("/login",{templateUrl:"/views/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"/views/register.html",controller:"createAccountCtrl"}).when("/admin",{templateUrl:"/views/admin.html",controller:"adminCtrl as ctrl"}).when("/account",{templateUrl:"/views/account.html",controller:""}).when("/dashboard",{templateUrl:"/views/dashboard.html",controller:"projectsCtrl"}).when("/projects",{templateUrl:"/views/project.html",controller:"projectsCtrl"}).when("/about",{templateUrl:"/views/about.html"}).when("/contact",{templateUrl:"/views/contact.html",controller:""}).when("/privacy",{templateUrl:"/views/privacy.html"}).when("/sources",{templateUrl:"/views/sources.html"}).otherwise({redirectTo:"/"})}]),app.controller("calculateCtrl",["$http","$mdDialog",function(t,e){function o(t){console.log("Text changed to ",t)}function n(t){void 0==t&&(s.category="",s.subcategory="",s.warmId="",s.weight="",s.conversion="",s.result="")}function r(){var e={warmId:s.warmId||s.category.secondaries[0].warm_id,weight:parseFloat(s.weight)*s.conversion};t.post("/calculations",e).then(function(t){s.result=Math.floor(1e3*Math.abs(t.data))/1e3})}function l(t){return t?s.list.filter(a(t)):s.list}function a(t){var e=t.toLowerCase();return function(t){return-1!=t.primary_cat.indexOf(e)}}function c(){console.log("SUBMIT!"),console.log(s.submission),t.post("/suggestion",s.submission).then(function(t){e.hide()})}function i(t){console.log("NEW SUGGESTION!",s.searchText),e.show({templateUrl:"/views/submit-modal.html",clickOutsideToClose:!0,controller:"calculateCtrl",controllerAs:"ctrl",locals:{material:s.searchText}})}t.get("/materials").then(function(t){var e=t.data;e.forEach(function(t){t.primary_cat=t.primary_cat.toLowerCase()}),s.list=e});var s=this;s.list="",s.result="",s.querySearch=l,s.selectedItemChange=n,s.searchTextChange=o,s.newSuggestion=i,s.submitSuggestion=c,s.units=[{name:"lbs",conversion:5e-4},{name:"kilos",conversion:.00110231},{name:"tons",conversion:1},{name:"metric tons",conversion:1.10231}],s.submission={email:"",material:"",notes:""},s.newCalculation=r}]),app.controller("adminCtrl",["$http",function(t){function e(e){var n=e.id;console.log(n),t.put("/suggestion/complete/"+n).then(function(t){o()})}function o(){t.get("/suggestion").then(function(t){var e=t.data;console.log(e),n.suggestions=e})}o();var n=this;n.suggestions="",n.markComplete=e}]),app.controller("createAccountCtrl",["$scope","$http","$location",function(t,e,o){t.user={},t.processForm=function(n){console.log("Posting..."),e({method:"POST",url:"/register",data:t.user,dataType:"json"}).then(function(t){console.log(t),o.path("/login"),alert("Your account has been created.")})}}]),app.controller("loginCtrl",["$scope","$http","authService","$location","$rootScope",function(t,e,o,n,r){t.login=function(){e({method:"POST",url:"/login",data:t.form}).then(function(t){o.saveToken(t.data.token),r.user=o.getUser(),n.path("/")})}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location","$http",function(t,e,o,n,r){o.user=t.getUser(),o.user&&o.user.username&&n.path("/"),e.logout=function(){t.logout(),o.user=t.getUser(),n.path("/")}}]),app.controller("projectsCtrl",["$scope","$http",function(t,e){e.get("/project").then(function(e){console.log(e),t.projectList=e.data}),t.deleteProjectItem=function(o){console.log("Deleting...",t.projectlist.lineID),e.update("/project").then(function(t){console.log("Item was deleted.",t)})}}]),app.controller("dashboardCtrl",["$scope","$http",function(t,e){e.get("/project").then(function(e){console.log(e),t.projectList=e.data})}]),app.service("authService",["$window",function(t){this.parseJwt=function(e){if(e){var o=e.split(".")[1],n=o.replace("-","+").replace("_","/");return JSON.parse(t.atob(n))}return{}},this.saveToken=function(e){t.localStorage.jwtToken=e,console.log("Saved token:",t.localStorage.jwtToken)},this.getToken=function(){return t.localStorage.jwtToken},this.isAuthed=function(){var t=this.getToken();if(t){var e=this.parseJwt(t),o=Math.round((new Date).getTime()/1e3)<=e.exp;return o||this.logout(),o}return!1},this.logout=function(){delete t.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(t,e,o){return{request:function(t){return t.headers=t.headers||{},o.isAuthed()&&(t.headers.Authorization="Bearer "+o.getToken()),t},response:function(o){return 401===o.status&&e.path("/login"),o||t.when(o)},responseError:function(o){return 401===o.status?e.path("/login"):console.log(o),t.reject(o)}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvYXBwLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImh0bWw1TW9kZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiZGVmYXVsdCIsIndhcm5QYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCIkaHR0cCIsIiRtZERpYWxvZyIsInNlYXJjaFRleHRDaGFuZ2UiLCJ0ZXh0IiwiY29uc29sZSIsImxvZyIsInNlbGVjdGVkSXRlbUNoYW5nZSIsIml0ZW0iLCJ1bmRlZmluZWQiLCJzZWxmIiwiY2F0ZWdvcnkiLCJzdWJjYXRlZ29yeSIsIndhcm1JZCIsIndlaWdodCIsImNvbnZlcnNpb24iLCJyZXN1bHQiLCJuZXdDYWxjdWxhdGlvbiIsImNhbGN1bGF0ZSIsInNlY29uZGFyaWVzIiwid2FybV9pZCIsInBhcnNlRmxvYXQiLCJwb3N0IiwidGhlbiIsInJlc3BvbnNlIiwiTWF0aCIsImZsb29yIiwiYWJzIiwiZGF0YSIsInF1ZXJ5U2VhcmNoIiwicXVlcnkiLCJsaXN0IiwiZmlsdGVyIiwiY3JlYXRlRmlsdGVyRm9yIiwibG93ZXJjYXNlUXVlcnkiLCJ0b0xvd2VyQ2FzZSIsIm9iaiIsInByaW1hcnlfY2F0IiwiaW5kZXhPZiIsInN1Ym1pdFN1Z2dlc3Rpb24iLCJzdWJtaXNzaW9uIiwicmVzIiwiaGlkZSIsIm5ld1N1Z2dlc3Rpb24iLCJzdWdnZXN0aW9uIiwic2VhcmNoVGV4dCIsInNob3ciLCJjbGlja091dHNpZGVUb0Nsb3NlIiwiY29udHJvbGxlckFzIiwibG9jYWxzIiwibWF0ZXJpYWwiLCJnZXQiLCJmb3JFYWNoIiwidGhpcyIsInVuaXRzIiwibmFtZSIsImVtYWlsIiwibm90ZXMiLCJtYXJrQ29tcGxldGUiLCJpZCIsInB1dCIsImluaXQiLCJzdWdnZXN0aW9ucyIsIiRzY29wZSIsIiRsb2NhdGlvbiIsInVzZXIiLCJwcm9jZXNzRm9ybSIsIm1ldGhvZCIsInVybCIsImRhdGFUeXBlIiwicGF0aCIsImFsZXJ0IiwiYXV0aFNlcnZpY2UiLCIkcm9vdFNjb3BlIiwibG9naW4iLCJmb3JtIiwic2F2ZVRva2VuIiwidG9rZW4iLCJnZXRVc2VyIiwidXNlcm5hbWUiLCJsb2dvdXQiLCJwcm9qZWN0TGlzdCIsImRlbGV0ZVByb2plY3RJdGVtIiwibGluZUlEIiwicHJvamVjdGxpc3QiLCJ1cGRhdGUiLCJzZXJ2aWNlIiwiJHdpbmRvdyIsInBhcnNlSnd0IiwiYmFzZTY0VXJsIiwic3BsaXQiLCJiYXNlNjQiLCJyZXBsYWNlIiwiSlNPTiIsInBhcnNlIiwiYXRvYiIsImxvY2FsU3RvcmFnZSIsImp3dFRva2VuIiwiZ2V0VG9rZW4iLCJpc0F1dGhlZCIsInBhcmFtcyIsIm5vdEV4cGlyZWQiLCJyb3VuZCIsIkRhdGUiLCJnZXRUaW1lIiwiZXhwIiwiZmFjdG9yeSIsIiRxIiwicmVxdWVzdCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwic3RhdHVzIiwicmVzcG9uc2VFcnJvciIsInJlamVjdCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsS0FBQUMsUUFBQUMsT0FBQSxjQUFBLFVBQUEsYUFBQSxhQUFBLG9CQUVBRixLQUFBRyxRQUFBLHFCQUFBLGlCQUFBLG9CQUFBLGdCQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEVBQUFDLEdBQ0FELEVBQUFFLFdBQUEsR0FHQUosRUFBQUssTUFBQSxXQUNBQyxlQUFBLFNBQ0FDLGNBQUEsYUFBQUMsVUFBQSxRQUNBQyxZQUFBLFVBR0FSLEVBQUFTLEtBQUEsS0FFQUMsWUFBQSx5QkFDQUMsV0FBQSwwQkFDQUYsS0FBQSxVQUVBQyxZQUFBLG9CQUNBQyxXQUFBLGNBQ0FGLEtBQUEsYUFFQUMsWUFBQSx1QkFDQUMsV0FBQSxzQkFDQUYsS0FB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QUlBcEgsSUFBQTRILFFBQUEsbUJBQUEsS0FBQSxZQUFBLGNBQUEsU0FBQUMsRUFBQTNDLEVBQUFRLEdBQ0EsT0FDQW9DLFFBQUEsU0FBQTNILEdBS0EsTUFKQUEsR0FBQTRILFFBQUE1SCxFQUFBNEgsWUFDQXJDLEVBQUEyQixhQUNBbEgsRUFBQTRILFFBQUFDLGNBQUEsVUFBQXRDLEVBQUEwQixZQUVBakgsR0FFQXVDLFNBQUEsU0FBQUEsR0FPQSxNQUxBLE9BQUFBLEVBQUF1RixRQUdBL0MsRUFBQU0sS0FBQSxVQUVBOUMsR0FBQW1GLEVBQUEvRyxLQUFBNEIsSUFDQXdGLGNBQUEsU0FBQXhGLEdBT0EsTUFOQSxPQUFBQSxFQUFBdUYsT0FDQS9DLEVBQUFNLEtBQUEsVUFHQWpFLFFBQUFDLElBQUFrQixHQUVBbUYsRUFBQU0sT0FBQXpGIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZWNvdG9uZUFwcCcsIFsnbmdSb3V0ZScsICduZ01hdGVyaWFsJywgJ25nTWVzc2FnZXMnLCAndmFsaWRhdGlvbi5tYXRjaCddKTtcblxuYXBwLmNvbmZpZyhbJyRtZFRoZW1pbmdQcm92aWRlcicsICckcm91dGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicsICckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24oJG1kVGhlbWluZ1Byb3ZpZGVyLCAkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIsICRodHRwUHJvdmlkZXIpe1xuICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgIC8vc2V0IHRoZW1lIGFuZCBjb2xvciBwYWxldHRlXG4gICAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAgICAgLnByaW1hcnlQYWxldHRlKCdncmVlbicpXG4gICAgICAgIC5hY2NlbnRQYWxldHRlKCdibHVlLWdyZXknLCB7J2RlZmF1bHQnOic2MDAnfSlcbiAgICAgICAgLndhcm5QYWxldHRlICgnb3JhbmdlJyk7XG5cbiAgICAvL3JvdXRlcyBmb3Igdmlld3NcbiAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY2FsY3VsYXRvci5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjYWxjdWxhdGVDdHJsIGFzIGN0cmwnXG4gICAgICAgIH0pLndoZW4oJy9sb2dpbicsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2xvZ2luLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2xvZ2luQ3RybCdcbiAgICAgICAgfSkud2hlbignL3JlZ2lzdGVyJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcmVnaXN0ZXIuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY3JlYXRlQWNjb3VudEN0cmwnXG4gICAgICAgIH0pLndoZW4oJy9hZG1pbicsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2FkbWluLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2FkbWluQ3RybCBhcyBjdHJsJ1xuXG4gICAgICAgIH0pLndoZW4oJy9hY2NvdW50JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvYWNjb3VudC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICcnXG4gICAgICAgIH0pLndoZW4oJy9kYXNoYm9hcmQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9kYXNoYm9hcmQuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncHJvamVjdHNDdHJsJ1xuICAgICAgICB9KS53aGVuKCcvcHJvamVjdHMnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9wcm9qZWN0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3Byb2plY3RzQ3RybCdcbiAgICAgICAgfSkud2hlbignL2Fib3V0JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvYWJvdXQuaHRtbCdcbiAgICAgICAgfSkud2hlbignL2NvbnRhY3QnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jb250YWN0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJydcbiAgICAgICAgfSkud2hlbignL3ByaXZhY3knLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9wcml2YWN5Lmh0bWwnXG4gICAgICAgIH0pLndoZW4oJy9zb3VyY2VzJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3Mvc291cmNlcy5odG1sJ1xuICAgICAgICB9KS5vdGhlcndpc2Uoe1xuICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICAgIH0pO1xuXG4gICAgLy8kaHR0cFByb3ZpZGVyLmludGVyY2VwdG9ycy5wdXNoKCdhdXRoSW50ZXJjZXB0b3InKTtcbn1dKTtcblxuYXBwLmNvbnRyb2xsZXIoJ2NhbGN1bGF0ZUN0cmwnLCBbJyRodHRwJywgJyRtZERpYWxvZycsIGZ1bmN0aW9uKCAkaHR0cCwgJG1kRGlhbG9nICkge1xuICAgIC8vIElOSVRcbiAgICAkaHR0cC5nZXQoJy9tYXRlcmlhbHMnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBsaXN0ID0gcmVzcG9uc2UuZGF0YTtcblxuICAgICAgICBsaXN0LmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICBpdGVtLnByaW1hcnlfY2F0ID0gaXRlbS5wcmltYXJ5X2NhdC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgLy8gL2l0ZW0ucHJpbWFyeV9jYXQgPSBpdGVtLnByaW1hcnlfY2F0LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgaXRlbS5wcmltYXJ5X2NhdC5zbGljZSgxKS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgICAgIH0pO1xuICAgICAgICBzZWxmLmxpc3QgPSBsaXN0O1xuXG4gICAgfSk7XG5cbiAgICAvLyBTZWxmIGRlY1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHNlbGYubGlzdCA9ICcnO1xuICAgIHNlbGYucmVzdWx0ID0gJyc7XG4gICAgc2VsZi5xdWVyeVNlYXJjaCA9IHF1ZXJ5U2VhcmNoO1xuICAgIHNlbGYuc2VsZWN0ZWRJdGVtQ2hhbmdlID0gc2VsZWN0ZWRJdGVtQ2hhbmdlO1xuICAgIHNlbGYuc2VhcmNoVGV4dENoYW5nZSAgID0gc2VhcmNoVGV4dENoYW5nZTtcbiAgICBzZWxmLm5ld1N1Z2dlc3Rpb24gPSBuZXdTdWdnZXN0aW9uO1xuICAgIHNlbGYuc3VibWl0U3VnZ2VzdGlvbiA9IHN1Ym1pdFN1Z2dlc3Rpb247XG4gICAgc2VsZi51bml0cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ2xicycsXG4gICAgICAgICAgICBjb252ZXJzaW9uOiAwLjAwMDVcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ2tpbG9zJyxcbiAgICAgICAgICAgIGNvbnZlcnNpb246IDAuMDAxMTAyMzFcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ3RvbnMnLFxuICAgICAgICAgICAgY29udmVyc2lvbjogMVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnbWV0cmljIHRvbnMnLFxuICAgICAgICAgICAgY29udmVyc2lvbjogMS4xMDIzMVxuICAgICAgICB9XG4gICAgXTtcbiAgICBzZWxmLnN1Ym1pc3Npb24gPSB7XG4gICAgICAgIGVtYWlsOiAnJyxcbiAgICAgICAgbWF0ZXJpYWw6ICcnLFxuICAgICAgICBub3RlczogJydcbiAgICB9O1xuICAgIHNlbGYubmV3Q2FsY3VsYXRpb24gPSBuZXdDYWxjdWxhdGlvbjtcblxuXG4gICAgZnVuY3Rpb24gc2VhcmNoVGV4dENoYW5nZSh0ZXh0KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUZXh0IGNoYW5nZWQgdG8gJywgdGV4dCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2VsZWN0ZWRJdGVtQ2hhbmdlKGl0ZW0pIHtcbiAgICAgICAgaWYgKCBpdGVtID09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgIHNlbGYuY2F0ZWdvcnkgPSAnJztcbiAgICAgICAgICAgIHNlbGYuc3ViY2F0ZWdvcnkgPSAnJztcbiAgICAgICAgICAgIHNlbGYud2FybUlkID0gJyc7XG4gICAgICAgICAgICBzZWxmLndlaWdodCA9ICcnO1xuICAgICAgICAgICAgc2VsZi5jb252ZXJzaW9uID0gJyc7XG4gICAgICAgICAgICBzZWxmLnJlc3VsdCA9ICcnO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbmV3Q2FsY3VsYXRpb24oKSB7XG5cbiAgICAgICAgdmFyIGNhbGN1bGF0ZSA9IHtcbiAgICAgICAgICAgIHdhcm1JZDogc2VsZi53YXJtSWQgfHwgc2VsZi5jYXRlZ29yeS5zZWNvbmRhcmllc1swXS53YXJtX2lkLFxuICAgICAgICAgICAgd2VpZ2h0OiBwYXJzZUZsb2F0KHNlbGYud2VpZ2h0KSAqIHNlbGYuY29udmVyc2lvblxuICAgICAgICB9O1xuXG4gICAgICAgICRodHRwLnBvc3QoJy9jYWxjdWxhdGlvbnMnLCBjYWxjdWxhdGUpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHNlbGYucmVzdWx0ID0gTWF0aC5mbG9vcihNYXRoLmFicyhyZXNwb25zZS5kYXRhKSAqIDEwMDApIC8gMTAwMDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2F2ZVRvUHJvamVjdCgpe1xuICAgICAgICB2YXIgbGluZUl0ZW0gPSB7XG4gICAgICAgICAgICBjYXRlZ29yeTogc2VsZi5jYXRlZ29yeSxcbiAgICAgICAgICAgIHN1YmNhdGVnb3J5OiBzZWxmLnN1YmNhdGVnb3J5LFxuICAgICAgICAgICAgd2FybV9JZDogc2VsZi53YXJtSWQsXG4gICAgICAgICAgICB3ZWlnaHQ6IHBhcnNlRmxvYXQoc2VsZi53ZWlnaHQpKnNlbGYuY29udmVyc2lvbixcbiAgICAgICAgICAgIHVuaXRzOiBzZWxmLnVuaXQubmFtZVxuICAgICAgICB9O1xuICAgICAgICBjb25zb2xlLmxvZyhsaW5lSXRlbSk7XG4gICAgICAgICRodHRwLnBvc3QoJy9hZGRUb1Byb2plY3QnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHF1ZXJ5U2VhcmNoKHF1ZXJ5KSB7XG4gICAgICAgIHJldHVybiBxdWVyeSA/IHNlbGYubGlzdC5maWx0ZXIoY3JlYXRlRmlsdGVyRm9yKHF1ZXJ5KSkgOiBzZWxmLmxpc3Q7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY3JlYXRlRmlsdGVyRm9yKHF1ZXJ5KSB7XG4gICAgICAgIHZhciBsb3dlcmNhc2VRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIC8vcXVlcnkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBxdWVyeS5zbGljZSgxKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZpbHRlckZuKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIChvYmoucHJpbWFyeV9jYXQuaW5kZXhPZihsb3dlcmNhc2VRdWVyeSkgIT0gLTEpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN1Ym1pdFN1Z2dlc3Rpb24oKXtcbiAgICAgICAgY29uc29sZS5sb2coJ1NVQk1JVCEnKTtcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi5zdWJtaXNzaW9uKTtcbiAgICAgICAgJGh0dHAucG9zdCgnL3N1Z2dlc3Rpb24nLCBzZWxmLnN1Ym1pc3Npb24pLnRoZW4oZnVuY3Rpb24oIHJlcyApe1xuICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBuZXdTdWdnZXN0aW9uKCBzdWdnZXN0aW9uICl7XG4gICAgICAgIGNvbnNvbGUubG9nKCdORVcgU1VHR0VTVElPTiEnLCBzZWxmLnNlYXJjaFRleHQpO1xuXG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3N1Ym1pdC1tb2RhbC5odG1sJyxcbiAgICAgICAgICAgIGNsaWNrT3V0c2lkZVRvQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY2FsY3VsYXRlQ3RybCcsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICdjdHJsJyxcbiAgICAgICAgICAgIGxvY2Fsczoge21hdGVyaWFsOiBzZWxmLnNlYXJjaFRleHR9XG4gICAgICAgIH0pXG5cbiAgICB9XG5cblxufV0pO1xuXG4vKipcbiAqIEFETUlOXG4gKi9cbmFwcC5jb250cm9sbGVyKCdhZG1pbkN0cmwnLCBbJyRodHRwJywgZnVuY3Rpb24oICRodHRwICl7XG4gICAgLy8gSU5JVFxuICAgIGluaXQoKTtcblxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLnN1Z2dlc3Rpb25zID0gJyc7XG4gICAgc2VsZi5tYXJrQ29tcGxldGUgPSBtYXJrQ29tcGxldGU7XG5cbiAgICBmdW5jdGlvbiBtYXJrQ29tcGxldGUoIHN1Z2dlc3Rpb24gKSB7XG4gICAgICAgIHZhciBpZCA9IHN1Z2dlc3Rpb24uaWQ7XG4gICAgICAgIGNvbnNvbGUubG9nKGlkKTtcbiAgICAgICAgJGh0dHAucHV0KCcvc3VnZ2VzdGlvbi9jb21wbGV0ZS8nICsgaWQpLnRoZW4oZnVuY3Rpb24oIHJlcyApIHtcbiAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvc3VnZ2VzdGlvbicpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgdmFyIHN1Z2dlc3Rpb25zID0gcmVzLmRhdGE7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzdWdnZXN0aW9ucyk7XG4gICAgICAgICAgICBzZWxmLnN1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnM7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG59XSk7XG5cbi8vIFJlZ2lzdGVyIEhUTUwgLSBNYWRlbGluZVxuYXBwLmNvbnRyb2xsZXIoJ2NyZWF0ZUFjY291bnRDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XG4gICAgJHNjb3BlLnVzZXIgPSB7fTtcblxuICAgICRzY29wZS5wcm9jZXNzRm9ybSA9IGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiUG9zdGluZy4uLlwiKTtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICcvcmVnaXN0ZXInLFxuICAgICAgICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XG4gICAgICAgICAgICBhbGVydChcIllvdXIgYWNjb3VudCBoYXMgYmVlbiBjcmVhdGVkLlwiKVxuICAgICAgICB9KVxuICAgIH07XG59XSk7XG5cblxuLy8gTG9naW4gSFRNTCAtIEthdGVcbmFwcC5jb250cm9sbGVyKCdsb2dpbkN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsICdhdXRoU2VydmljZScsICckbG9jYXRpb24nLCAnJHJvb3RTY29wZScsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsIGF1dGhTZXJ2aWNlLCAkbG9jYXRpb24sICRyb290U2NvcGUpIHtcbiAgICAkc2NvcGUubG9naW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnL2xvZ2luJyxcbiAgICAgICAgICAgIGRhdGE6ICRzY29wZS5mb3JtXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgYXV0aFNlcnZpY2Uuc2F2ZVRva2VuKHJlc3BvbnNlLmRhdGEudG9rZW4pO1xuICAgICAgICAgICAgJHJvb3RTY29wZS51c2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICAgICAgfSlcbiAgICB9XG59XSk7XG5cbi8vIENoYW5nZSBOYXZpZ2F0aW9uIE9wdGlvbnMgd2l0aCBMb2dpblxuYXBwLmNvbnRyb2xsZXIoJ25hdkN0cmwnLCBbJ2F1dGhTZXJ2aWNlJywgJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckaHR0cCcsIGZ1bmN0aW9uKGF1dGhTZXJ2aWNlLCAkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgJGh0dHApe1xuICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcblxuICAgIGlmKCRyb290U2NvcGUudXNlciAmJiAkcm9vdFNjb3BlLnVzZXIudXNlcm5hbWUpe1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgIH1cblxuICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbigpe1xuICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQoKTtcbiAgICAgICAgJHJvb3RTY29wZS51c2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xuICAgICAgICAkbG9jYXRpb24ucGF0aCgnLycpO1xuICAgIH1cbn1dKTtcblxuLy8gUHJvamVjdCBIVE1MIC0gRGFzaGJvYXJkIEhUTUwgLSBLaW1cbmFwcC5jb250cm9sbGVyKCdwcm9qZWN0c0N0cmwnLCBbJyRzY29wZScsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcbiAgICAkaHR0cC5nZXQoJy9wcm9qZWN0JykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAkc2NvcGUucHJvamVjdExpc3QgPSByZXNwb25zZS5kYXRhO1xuICAgICAgICAvL3Jlc3BvbnNlLmRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgLy8gICAgaXRlbS5wcm9qZWN0X25hbWUgPSBpdGVtLnByaW1hcnlfY2F0LnRvTG93ZXJDYXNlKCk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuZGVsZXRlUHJvamVjdEl0ZW0gPSBmdW5jdGlvbiAobGluZUlEKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRGVsZXRpbmcuLi5cIiwgJHNjb3BlLnByb2plY3RsaXN0LmxpbmVJRCk7XG4gICAgICAgICRodHRwLnVwZGF0ZSgnL3Byb2plY3QnKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgLy9maW5kT25lIGFuZCBkZWxldGUgYnkgSUQgdXNpbmcgcHJvamVjdGxpc3QubGluZUlEXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkl0ZW0gd2FzIGRlbGV0ZWQuXCIsIHJlc3BvbnNlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vJHNjb3BlLmNhbGN1bGF0ZVByb2plY3RUb3RhbCgpe1xuICAgICAgICAvLy8vZm9yRWFjaCBwcm9qZWN0XG4gICAgICAgIC8vICAgIHZhciBwcm9qZWN0VG90YWwrPXByb2plY3RMaXN0LmNvMl9vZmZzZXQ7XG4gICAgICAgIC8vICAgIHJldHVybiBwcm9qZWN0VG90YWw7XG4gICAgICAgIC8vLy9zYXZlIHRvIHByb2plY3Q/IG9yIGp1c3QgcmVjYWxjIGVhY2ggdGltZT9cbiAgICAgICAgLy99XG4gICAgfTtcbn1dKTtcblxuXG4vL0Rhc2hib2FyZCBQYWdlIC0gS2ltL01hZGVsZWluZVxuYXBwLmNvbnRyb2xsZXIoJ2Rhc2hib2FyZEN0cmwnLCBbJyRzY29wZScsICckaHR0cCcsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHApIHtcbiAgICAvL2xvYWQgcHJvamVjdCBsaXN0IG9uIHBhZ2UgbG9hZFxuICAgICRodHRwLmdldCgnL3Byb2plY3QnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgJHNjb3BlLnByb2plY3RMaXN0ID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgLy9yZXNwb25zZS5kYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgIC8vICAgIGl0ZW0ucHJvamVjdF9uYW1lID0gaXRlbS5wcmltYXJ5X2NhdC50b0xvd2VyQ2FzZSgpO1xuICAgIH0pO1xufV0pO1xuXG5cbi8vIFNlcnZpY2VzIGZvciBhdXRoZW50aWNhdGlvblxuYXBwLnNlcnZpY2UoJ2F1dGhTZXJ2aWNlJywgWyckd2luZG93JywgZnVuY3Rpb24gKCR3aW5kb3cpe1xuICAgIHRoaXMucGFyc2VKd3QgPSBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICB2YXIgYmFzZTY0VXJsID0gdG9rZW4uc3BsaXQoJy4nKVsxXTtcbiAgICAgICAgICAgIHZhciBiYXNlNjQgPSBiYXNlNjRVcmwucmVwbGFjZSgnLScsICcrJykucmVwbGFjZSgnXycsICcvJyk7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZSgkd2luZG93LmF0b2IoYmFzZTY0KSk7XG4gICAgICAgIH0gZWxzZSByZXR1cm4ge307XG4gICAgfTtcblxuICAgIHRoaXMuc2F2ZVRva2VuID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuID0gdG9rZW47XG4gICAgICAgIGNvbnNvbGUubG9nKCdTYXZlZCB0b2tlbjonLCR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuKTtcbiAgICB9O1xuXG4gICAgdGhpcy5nZXRUb2tlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuO1xuICAgIH07XG5cbiAgICB0aGlzLmlzQXV0aGVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHRoaXMucGFyc2VKd3QodG9rZW4pO1xuICAgICAgICAgICAgdmFyIG5vdEV4cGlyZWQgPSBNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMCkgPD0gcGFyYW1zLmV4cDtcbiAgICAgICAgICAgIGlmICghbm90RXhwaXJlZCkge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nb3V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbm90RXhwaXJlZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZGVsZXRlICR3aW5kb3cubG9jYWxTdG9yYWdlLmp3dFRva2VuO1xuICAgIH07XG5cbiAgICAvLyBleHBvc2UgdXNlciBhcyBhbiBvYmplY3RcbiAgICB0aGlzLmdldFVzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcnNlSnd0KHRoaXMuZ2V0VG9rZW4oKSlcbiAgICB9O1xufV0pO1xuXG5hcHAuZmFjdG9yeSgnYXV0aEludGVyY2VwdG9yJywgWyckcScsICckbG9jYXRpb24nLCAnYXV0aFNlcnZpY2UnLCBmdW5jdGlvbiAoJHEsICRsb2NhdGlvbiwgYXV0aFNlcnZpY2UpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgICAgICBjb25maWcuaGVhZGVycyA9IGNvbmZpZy5oZWFkZXJzIHx8IHt9O1xuICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLmlzQXV0aGVkKCkpIHtcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVycy5BdXRob3JpemF0aW9uID0gJ0JlYXJlciAnICsgYXV0aFNlcnZpY2UuZ2V0VG9rZW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIHVzZXIgaXMgbm90IGF1dGhlbnRpY2F0ZWRcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZSB8fCAkcS53aGVuKHJlc3BvbnNlKTtcbiAgICAgICAgfSwgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aChcIi9sb2dpblwiKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH07XG59XSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
