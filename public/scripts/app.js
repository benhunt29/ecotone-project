var app=angular.module("ecotoneApp",["ngRoute","ngMaterial","ngMessages","validation.match"]);app.config(["$mdThemingProvider","$routeProvider","$locationProvider","$httpProvider",function(t,e,o,n){o.html5Mode(!0),t.theme("default").primaryPalette("green").accentPalette("blue-grey",{"default":"600"}).warnPalette("orange"),e.when("/",{templateUrl:"/views/calculator.html",controller:"calculateCtrl as ctrl"}).when("/login",{templateUrl:"/views/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"/views/register.html",controller:"createAccountCtrl"}).when("/admin",{templateUrl:"/views/admin.html",controller:"adminCtrl as ctrl"}).when("/account",{templateUrl:"/views/account.html",controller:""}).when("/dashboard",{templateUrl:"/views/dashboard.html",controller:"projectsCtrl"}).when("/projects",{templateUrl:"/views/project.html",controller:"projectsCtrl"}).when("/about",{templateUrl:"/views/about.html"}).when("/contact",{templateUrl:"/views/contact.html",controller:""}).when("/privacy",{templateUrl:"/views/privacy.html"}).when("/sources",{templateUrl:"/views/sources.html"}).otherwise({redirectTo:"/"})}]),app.controller("calculateCtrl",["$http","$mdDialog","$rootScope","authService","$location",function(t,e,o,n,r){function a(t){console.log("Text changed to ",t)}function l(t){void 0==t&&(p.category="",p.subcategory="",p.warmId="",p.weight="",p.conversion="",p.result="")}function c(){var e={warmId:p.warmId||p.category.secondaries[0].warm_id,weight:parseFloat(p.weight)*p.conversion};t.post("/calculations",e).then(function(t){p.result=Math.floor(1e3*Math.abs(t.data))/1e3})}function i(t){return t?p.list.filter(s(t)):p.list}function s(t){var e=t.toLowerCase();return function(t){return-1!=t.primary_cat.indexOf(e)}}function u(){t.post("/suggestion",p.submission).then(function(t){e.hide()})}function h(t){document.getElementById("sidenav").focus(),e.show({templateUrl:"/views/submit-modal.html",clickOutsideToClose:!0,controller:"calculateCtrl",controllerAs:"ctrl",locals:{material:p.searchText}})}o.user=n.getUser(),o.user&&o.user.username&&r.path("/"),t.get("/materials").then(function(t){var e=t.data;e.forEach(function(t){t.primary_cat=t.primary_cat.toLowerCase()}),p.list=e});var p=this;p.list="",p.isDisabled=!1,p.result="",p.querySearch=i,p.selectedItemChange=l,p.searchTextChange=a,p.newSuggestion=h,p.submitSuggestion=u,p.units=[{name:"lbs",conversion:5e-4},{name:"kilos",conversion:.00110231},{name:"tons",conversion:1},{name:"metric tons",conversion:1.10231}],p.submission={email:"",material:"",notes:""},p.newCalculation=c}]),app.controller("adminCtrl",["$http",function(t){function e(e){var n=e.id;console.log(n),t.put("/suggestion/complete/"+n).then(function(t){o()})}function o(){t.get("/suggestion").then(function(t){var e=t.data;console.log(e),n.suggestions=e})}o();var n=this;n.suggestions="",n.markComplete=e}]),app.controller("createAccountCtrl",["$scope","$http","$location",function(t,e,o){t.user={},t.processForm=function(n){console.log("Posting..."),e({method:"POST",url:"/register",data:t.user,dataType:"json"}).then(function(t){console.log(t),o.path("/login"),alert("Your account has been created.")})}}]),app.controller("loginCtrl",["$scope","$http","authService","$location","$rootScope",function(t,e,o,n,r){t.login=function(){e({method:"POST",url:"/login",data:t.form}).then(function(t){o.saveToken(t.data.token),r.user=o.getUser(),n.path("/")})}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location","$http",function(t,e,o,n,r){o.user=t.getUser(),o.user&&o.user.username&&n.path("/"),e.logout=function(){t.logout(),o.user=t.getUser(),n.path("/")}}]),app.controller("projectsCtrl",["$scope","$http",function(t,e){e.get("/project").then(function(e){console.log(e),t.projectList=e.data}),t.deleteProjectItem=function(o){console.log("Deleting...",t.projectlist.lineID),e.update("/project").then(function(t){console.log("Item was deleted.",t)})}}]),app.controller("dashboardCtrl",["$scope","$http",function(t,e){e.get("/project").then(function(e){console.log(e),t.projectList=e.data})}]),app.service("authService",["$window",function(t){this.parseJwt=function(e){if(e){var o=e.split(".")[1],n=o.replace("-","+").replace("_","/");return JSON.parse(t.atob(n))}return{}},this.saveToken=function(e){t.localStorage.jwtToken=e,console.log("Saved token:",t.localStorage.jwtToken)},this.getToken=function(){return t.localStorage.jwtToken},this.isAuthed=function(){var t=this.getToken();if(t){var e=this.parseJwt(t),o=Math.round((new Date).getTime()/1e3)<=e.exp;return o||this.logout(),o}return!1},this.logout=function(){delete t.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(t,e,o){return{request:function(t){return t.headers=t.headers||{},o.isAuthed()&&(t.headers.Authorization="Bearer "+o.getToken()),t},response:function(o){return 401===o.status&&e.path("/login"),o||t.when(o)},responseError:function(o){return 401===o.status?e.path("/login"):console.log(o),t.reject(o)}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvYXBwLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImh0bWw1TW9kZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiZGVmYXVsdCIsIndhcm5QYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCIkaHR0cCIsIiRtZERpYWxvZyIsIiRyb290U2NvcGUiLCJhdXRoU2VydmljZSIsIiRsb2NhdGlvbiIsInNlYXJjaFRleHRDaGFuZ2UiLCJ0ZXh0IiwiY29uc29sZSIsImxvZyIsInNlbGVjdGVkSXRlbUNoYW5nZSIsIml0ZW0iLCJ1bmRlZmluZWQiLCJzZWxmIiwiY2F0ZWdvcnkiLCJzdWJjYXRlZ29yeSIsIndhcm1JZCIsIndlaWdodCIsImNvbnZlcnNpb24iLCJyZXN1bHQiLCJuZXdDYWxjdWxhdGlvbiIsImNhbGN1bGF0ZSIsInNlY29uZGFyaWVzIiwid2FybV9pZCIsInBhcnNlRmxvYXQiLCJwb3N0IiwidGhlbiIsInJlc3BvbnNlIiwiTWF0aCIsImZsb29yIiwiYWJzIiwiZGF0YSIsInF1ZXJ5U2VhcmNoIiwicXVlcnkiLCJsaXN0IiwiZmlsdGVyIiwiY3JlYXRlRmlsdGVyRm9yIiwibG93ZXJjYXNlUXVlcnkiLCJ0b0xvd2VyQ2FzZSIsIm9iaiIsInByaW1hcnlfY2F0IiwiaW5kZXhPZiIsInN1Ym1pdFN1Z2dlc3Rpb24iLCJzdWJtaXNzaW9uIiwicmVzIiwiaGlkZSIsIm5ld1N1Z2dlc3Rpb24iLCJzdWdnZXN0aW9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImZvY3VzIiwic2hvdyIsImNsaWNrT3V0c2lkZVRvQ2xvc2UiLCJjb250cm9sbGVyQXMiLCJsb2NhbHMiLCJtYXRlcmlhbCIsInNlYXJjaFRleHQiLCJ1c2VyIiwiZ2V0VXNlciIsInVzZXJuYW1lIiwicGF0aCIsImdldCIsImZvckVhY2giLCJ0aGlzIiwiaXNEaXNhYmxlZCIsInVuaXRzIiwibmFtZSIsImVtYWlsIiwibm90ZXMiLCJtYXJrQ29tcGxldGUiLCJpZCIsInB1dCIsImluaXQiLCJzdWdnZXN0aW9ucyIsIiRzY29wZSIsInByb2Nlc3NGb3JtIiwibWV0aG9kIiwidXJsIiwiZGF0YVR5cGUiLCJhbGVydCIsImxvZ2luIiwiZm9ybSIsInNhdmVUb2tlbiIsInRva2VuIiwibG9nb3V0IiwicHJvamVjdExpc3QiLCJkZWxldGVQcm9qZWN0SXRlbSIsImxpbmVJRCIsInByb2plY3RsaXN0IiwidXBkYXRlIiwic2VydmljZSIsIiR3aW5kb3ciLCJwYXJzZUp3dCIsImJhc2U2NFVybCIsInNwbGl0IiwiYmFzZTY0IiwicmVwbGFjZSIsIkpTT04iLCJwYXJzZSIsImF0b2IiLCJsb2NhbFN0b3JhZ2UiLCJqd3RUb2tlbiIsImdldFRva2VuIiwiaXNBdXRoZWQiLCJwYXJhbXMiLCJub3RFeHBpcmVkIiwicm91bmQiLCJEYXRlIiwiZ2V0VGltZSIsImV4cCIsImZhY3RvcnkiLCIkcSIsInJlcXVlc3QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsInN0YXR1cyIsInJlc3BvbnNlRXJyb3IiLCJyZWplY3QiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUlBLEtBQU1DLFFBQVFDLE9BQU8sY0FBZSxVQUFXLGFBQWMsYUFBYyxvQkFFL0VGLEtBQUlHLFFBQVEscUJBQXNCLGlCQUFrQixvQkFBcUIsZ0JBQWlCLFNBQVNDLEVBQW9CQyxFQUFnQkMsRUFBbUJDLEdBQ3RKRCxFQUFrQkUsV0FBVSxHQUc1QkosRUFBbUJLLE1BQU0sV0FDcEJDLGVBQWUsU0FDZkMsY0FBYyxhQUFjQyxVQUFVLFFBQ3RDQyxZQUFhLFVBR2xCUixFQUFlUyxLQUFLLEtBRVpDLFlBQWEseUJBQ2JDLFdBQVksMEJBQ2JGLEtBQUssVUFF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QUdoQ3RDLEtBQUt3QyxTQUFXLFdBQ1osR0FBSXBCLEdBQVFwQixLQUFLdUMsVUFDakIsSUFBSW5CLEVBQU8sQ0FDUCxHQUFJcUIsR0FBU3pDLEtBQUs2QixTQUFTVCxHQUN2QnNCLEVBQWE3RSxLQUFLOEUsT0FBTSxHQUFJQyxPQUFPQyxVQUFZLE1BQVNKLEVBQU9LLEdBSW5FLE9BSEtKLElBQ0QxQyxLQUFLcUIsU0FFRnFCLEVBRVAsT0FBTyxHQUlmMUMsS0FBS3FCLE9BQVMsaUJBQ0hPLEdBQVFTLGFBQWFDLFVBSWhDdEMsS0FBS0wsUUFBVSxXQUNYLE1BQU9LLE1BQUs2QixTQUFTN0IsS0FBS3VDLGdCQUlsQ3hILElBQUlnSSxRQUFRLG1CQUFvQixLQUFNLFlBQWEsY0FBZSxTQUFVQyxFQUFJMUcsRUFBV0QsR0FDdkYsT0FDSTRHLFFBQVMsU0FBVS9ILEdBS2YsTUFKQUEsR0FBT2dJLFFBQVVoSSxFQUFPZ0ksWUFDcEI3RyxFQUFZbUcsYUFDWnRILEVBQU9nSSxRQUFRQyxjQUFnQixVQUFZOUcsRUFBWWtHLFlBRXBEckgsR0FFWDBDLFNBQVUsU0FBVUEsR0FPaEIsTUFMd0IsT0FBcEJBLEVBQVN3RixRQUdUOUcsRUFBVXVELEtBQUssVUFFWmpDLEdBQVlvRixFQUFHbkgsS0FBSytCLElBQzVCeUYsY0FBZSxTQUFVekYsR0FPeEIsTUFOd0IsT0FBcEJBLEVBQVN3RixPQUNUOUcsRUFBVXVELEtBQUssVUFHZnBELFFBQVFDLElBQUlrQixHQUVUb0YsRUFBR00sT0FBTzFGIiwiZmlsZSI6InNjcmlwdHMvYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdlY290b25lQXBwJywgWyduZ1JvdXRlJywgJ25nTWF0ZXJpYWwnLCAnbmdNZXNzYWdlcycsICd2YWxpZGF0aW9uLm1hdGNoJ10pO1xuXG5hcHAuY29uZmlnKFsnJG1kVGhlbWluZ1Byb3ZpZGVyJywgJyRyb3V0ZVByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbigkbWRUaGVtaW5nUHJvdmlkZXIsICRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJGh0dHBQcm92aWRlcil7XG4gICAgJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xuXG4gICAgLy9zZXQgdGhlbWUgYW5kIGNvbG9yIHBhbGV0dGVcbiAgICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgICAgICAucHJpbWFyeVBhbGV0dGUoJ2dyZWVuJylcbiAgICAgICAgLmFjY2VudFBhbGV0dGUoJ2JsdWUtZ3JleScsIHsnZGVmYXVsdCc6JzYwMCd9KVxuICAgICAgICAud2FyblBhbGV0dGUgKCdvcmFuZ2UnKTtcblxuICAgIC8vcm91dGVzIGZvciB2aWV3c1xuICAgICRyb3V0ZVByb3ZpZGVyLndoZW4oJy8nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9jYWxjdWxhdG9yLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NhbGN1bGF0ZUN0cmwgYXMgY3RybCdcbiAgICAgICAgfSkud2hlbignL2xvZ2luJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvbG9naW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnbG9naW5DdHJsJ1xuICAgICAgICB9KS53aGVuKCcvcmVnaXN0ZXInLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9yZWdpc3Rlci5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdjcmVhdGVBY2NvdW50Q3RybCdcbiAgICAgICAgfSkud2hlbignL2FkbWluJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvYWRtaW4uaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnYWRtaW5DdHJsIGFzIGN0cmwnXG5cbiAgICAgICAgfSkud2hlbignL2FjY291bnQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9hY2NvdW50Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJydcbiAgICAgICAgfSkud2hlbignL2Rhc2hib2FyZCcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2Rhc2hib2FyZC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcm9qZWN0c0N0cmwnXG4gICAgICAgIH0pLndoZW4oJy9wcm9qZWN0cycsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3Byb2plY3QuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAncHJvamVjdHNDdHJsJ1xuICAgICAgICB9KS53aGVuKCcvYWJvdXQnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9hYm91dC5odG1sJ1xuICAgICAgICB9KS53aGVuKCcvY29udGFjdCcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NvbnRhY3QuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnJ1xuICAgICAgICB9KS53aGVuKCcvcHJpdmFjeScsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3ByaXZhY3kuaHRtbCdcbiAgICAgICAgfSkud2hlbignL3NvdXJjZXMnLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9zb3VyY2VzLmh0bWwnXG4gICAgICAgIH0pLm90aGVyd2lzZSh7XG4gICAgICAgICAgICByZWRpcmVjdFRvOiAnLydcbiAgICAgICAgfSk7XG5cbiAgICAvLyRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ2F1dGhJbnRlcmNlcHRvcicpO1xufV0pO1xuXG5hcHAuY29udHJvbGxlcignY2FsY3VsYXRlQ3RybCcsIFsnJGh0dHAnLCAnJG1kRGlhbG9nJywgJyRyb290U2NvcGUnLCAnYXV0aFNlcnZpY2UnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oICRodHRwLCAkbWREaWFsb2csICRyb290U2NvcGUsIGF1dGhTZXJ2aWNlLCAkbG9jYXRpb24gKSB7XG5cbiAgICAvLyBDaGVjayB1c2VyXG4gICAgJHJvb3RTY29wZS51c2VyID0gYXV0aFNlcnZpY2UuZ2V0VXNlcigpO1xuXG4gICAgaWYoJHJvb3RTY29wZS51c2VyICYmICRyb290U2NvcGUudXNlci51c2VybmFtZSl7XG4gICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgfVxuXG4gICAgLy8gSU5JVFxuICAgICRodHRwLmdldCgnL21hdGVyaWFscycpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIGxpc3QgPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgIGxpc3QuZm9yRWFjaChmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgICAgIGl0ZW0ucHJpbWFyeV9jYXQgPSBpdGVtLnByaW1hcnlfY2F0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAvLyAvaXRlbS5wcmltYXJ5X2NhdCA9IGl0ZW0ucHJpbWFyeV9jYXQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBpdGVtLnByaW1hcnlfY2F0LnNsaWNlKDEpLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgfSk7XG4gICAgICAgIHNlbGYubGlzdCA9IGxpc3Q7XG5cbiAgICB9KTtcblxuICAgIC8vIFNlbGYgZGVjXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgc2VsZi5saXN0ID0gJyc7XG4gICAgc2VsZi5pc0Rpc2FibGVkID0gZmFsc2U7XG4gICAgc2VsZi5yZXN1bHQgPSAnJztcbiAgICBzZWxmLnF1ZXJ5U2VhcmNoID0gcXVlcnlTZWFyY2g7XG4gICAgc2VsZi5zZWxlY3RlZEl0ZW1DaGFuZ2UgPSBzZWxlY3RlZEl0ZW1DaGFuZ2U7XG4gICAgc2VsZi5zZWFyY2hUZXh0Q2hhbmdlICAgPSBzZWFyY2hUZXh0Q2hhbmdlO1xuICAgIHNlbGYubmV3U3VnZ2VzdGlvbiA9IG5ld1N1Z2dlc3Rpb247XG4gICAgc2VsZi5zdWJtaXRTdWdnZXN0aW9uID0gc3VibWl0U3VnZ2VzdGlvbjtcbiAgICBzZWxmLnVuaXRzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAnbGJzJyxcbiAgICAgICAgICAgIGNvbnZlcnNpb246IDAuMDAwNVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAna2lsb3MnLFxuICAgICAgICAgICAgY29udmVyc2lvbjogMC4wMDExMDIzMVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiAndG9ucycsXG4gICAgICAgICAgICBjb252ZXJzaW9uOiAxXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdtZXRyaWMgdG9ucycsXG4gICAgICAgICAgICBjb252ZXJzaW9uOiAxLjEwMjMxXG4gICAgICAgIH1cbiAgICBdO1xuICAgIHNlbGYuc3VibWlzc2lvbiA9IHtcbiAgICAgICAgZW1haWw6ICcnLFxuICAgICAgICBtYXRlcmlhbDogJycsXG4gICAgICAgIG5vdGVzOiAnJ1xuICAgIH07XG4gICAgc2VsZi5uZXdDYWxjdWxhdGlvbiA9IG5ld0NhbGN1bGF0aW9uO1xuXG5cbiAgICBmdW5jdGlvbiBzZWFyY2hUZXh0Q2hhbmdlKHRleHQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1RleHQgY2hhbmdlZCB0byAnLCB0ZXh0KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZWxlY3RlZEl0ZW1DaGFuZ2UoaXRlbSkge1xuICAgICAgICBpZiAoIGl0ZW0gPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgc2VsZi5jYXRlZ29yeSA9ICcnO1xuICAgICAgICAgICAgc2VsZi5zdWJjYXRlZ29yeSA9ICcnO1xuICAgICAgICAgICAgc2VsZi53YXJtSWQgPSAnJztcbiAgICAgICAgICAgIHNlbGYud2VpZ2h0ID0gJyc7XG4gICAgICAgICAgICBzZWxmLmNvbnZlcnNpb24gPSAnJztcbiAgICAgICAgICAgIHNlbGYucmVzdWx0ID0gJyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBuZXdDYWxjdWxhdGlvbigpIHtcblxuICAgICAgICB2YXIgY2FsY3VsYXRlID0ge1xuICAgICAgICAgICAgd2FybUlkOiBzZWxmLndhcm1JZCB8fCBzZWxmLmNhdGVnb3J5LnNlY29uZGFyaWVzWzBdLndhcm1faWQsXG4gICAgICAgICAgICB3ZWlnaHQ6IHBhcnNlRmxvYXQoc2VsZi53ZWlnaHQpICogc2VsZi5jb252ZXJzaW9uXG4gICAgICAgIH07XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2NhbGN1bGF0aW9ucycsIGNhbGN1bGF0ZSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgc2VsZi5yZXN1bHQgPSBNYXRoLmZsb29yKE1hdGguYWJzKHJlc3BvbnNlLmRhdGEpICogMTAwMCkgLyAxMDAwO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzYXZlVG9Qcm9qZWN0KCl7XG4gICAgICAgIHZhciBsaW5lSXRlbSA9IHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBzZWxmLmNhdGVnb3J5LFxuICAgICAgICAgICAgc3ViY2F0ZWdvcnk6IHNlbGYuc3ViY2F0ZWdvcnksXG4gICAgICAgICAgICB3YXJtX0lkOiBzZWxmLndhcm1JZCxcbiAgICAgICAgICAgIHdlaWdodDogcGFyc2VGbG9hdChzZWxmLndlaWdodCkqc2VsZi5jb252ZXJzaW9uLFxuICAgICAgICAgICAgdW5pdHM6IHNlbGYudW5pdC5uYW1lXG4gICAgICAgIH07XG4gICAgICAgIGNvbnNvbGUubG9nKGxpbmVJdGVtKTtcbiAgICAgICAgJGh0dHAucG9zdCgnL2FkZFRvUHJvamVjdCcpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcXVlcnlTZWFyY2gocXVlcnkpIHtcbiAgICAgICAgcmV0dXJuIHF1ZXJ5ID8gc2VsZi5saXN0LmZpbHRlcihjcmVhdGVGaWx0ZXJGb3IocXVlcnkpKSA6IHNlbGYubGlzdDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVGaWx0ZXJGb3IocXVlcnkpIHtcbiAgICAgICAgdmFyIGxvd2VyY2FzZVF1ZXJ5ID0gcXVlcnkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgLy9xdWVyeS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5LnNsaWNlKDEpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gZmlsdGVyRm4ob2JqKSB7XG4gICAgICAgICAgICByZXR1cm4gKG9iai5wcmltYXJ5X2NhdC5pbmRleE9mKGxvd2VyY2FzZVF1ZXJ5KSAhPSAtMSk7XG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3VibWl0U3VnZ2VzdGlvbigpe1xuICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL3N1Z2dlc3Rpb24nLCBzZWxmLnN1Ym1pc3Npb24pLnRoZW4oZnVuY3Rpb24oIHJlcyApe1xuICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBuZXdTdWdnZXN0aW9uKCBzdWdnZXN0aW9uICl7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWRlbmF2JykuZm9jdXMoKTtcblxuICAgICAgICAkbWREaWFsb2cuc2hvdyh7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9zdWJtaXQtbW9kYWwuaHRtbCcsXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NhbGN1bGF0ZUN0cmwnLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAnY3RybCcsXG4gICAgICAgICAgICBsb2NhbHM6IHttYXRlcmlhbDogc2VsZi5zZWFyY2hUZXh0fVxuICAgICAgICB9KVxuXG4gICAgfVxuXG5cbn1dKTtcblxuLyoqXG4gKiBBRE1JTlxuICovXG5hcHAuY29udHJvbGxlcignYWRtaW5DdHJsJywgWyckaHR0cCcsIGZ1bmN0aW9uKCAkaHR0cCApe1xuICAgIC8vIElOSVRcbiAgICBpbml0KCk7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5zdWdnZXN0aW9ucyA9ICcnO1xuICAgIHNlbGYubWFya0NvbXBsZXRlID0gbWFya0NvbXBsZXRlO1xuXG4gICAgZnVuY3Rpb24gbWFya0NvbXBsZXRlKCBzdWdnZXN0aW9uICkge1xuICAgICAgICB2YXIgaWQgPSBzdWdnZXN0aW9uLmlkO1xuICAgICAgICBjb25zb2xlLmxvZyhpZCk7XG4gICAgICAgICRodHRwLnB1dCgnL3N1Z2dlc3Rpb24vY29tcGxldGUvJyArIGlkKS50aGVuKGZ1bmN0aW9uKCByZXMgKSB7XG4gICAgICAgICAgICBpbml0KCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgICRodHRwLmdldCgnL3N1Z2dlc3Rpb24nKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIHZhciBzdWdnZXN0aW9ucyA9IHJlcy5kYXRhO1xuICAgICAgICAgICAgY29uc29sZS5sb2coc3VnZ2VzdGlvbnMpO1xuICAgICAgICAgICAgc2VsZi5zdWdnZXN0aW9ucyA9IHN1Z2dlc3Rpb25zO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxufV0pO1xuXG4vLyBSZWdpc3RlciBIVE1MIC0gTWFkZWxpbmVcbmFwcC5jb250cm9sbGVyKCdjcmVhdGVBY2NvdW50Q3RybCcsIFsnJHNjb3BlJywgJyRodHRwJywgJyRsb2NhdGlvbicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbikge1xuICAgICRzY29wZS51c2VyID0ge307XG5cbiAgICAkc2NvcGUucHJvY2Vzc0Zvcm0gPSBmdW5jdGlvbiAodXNlcikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlBvc3RpbmcuLi5cIik7XG4gICAgICAgICRodHRwKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgdXJsOiAnL3JlZ2lzdGVyJyxcbiAgICAgICAgICAgIGRhdGE6ICRzY29wZS51c2VyLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xuICAgICAgICAgICAgYWxlcnQoXCJZb3VyIGFjY291bnQgaGFzIGJlZW4gY3JlYXRlZC5cIilcbiAgICAgICAgfSlcbiAgICB9O1xufV0pO1xuXG5cbi8vIExvZ2luIEhUTUwgLSBLYXRlXG5hcHAuY29udHJvbGxlcignbG9naW5DdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnYXV0aFNlcnZpY2UnLCAnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBhdXRoU2VydmljZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlKSB7XG4gICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJy9sb2dpbicsXG4gICAgICAgICAgICBkYXRhOiAkc2NvcGUuZm9ybVxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnNhdmVUb2tlbihyZXNwb25zZS5kYXRhLnRva2VuKTtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgIH0pXG4gICAgfVxufV0pO1xuXG4vLyBDaGFuZ2UgTmF2aWdhdGlvbiBPcHRpb25zIHdpdGggTG9naW5cbmFwcC5jb250cm9sbGVyKCduYXZDdHJsJywgWydhdXRoU2VydmljZScsICckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCBmdW5jdGlvbihhdXRoU2VydmljZSwgJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRodHRwKXtcbiAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG5cbiAgICBpZigkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9XG5cbiAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgYXV0aFNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9XG59XSk7XG5cbi8vIFByb2plY3QgSFRNTCAtIERhc2hib2FyZCBIVE1MIC0gS2ltXG5hcHAuY29udHJvbGxlcigncHJvamVjdHNDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG4gICAgJGh0dHAuZ2V0KCcvcHJvamVjdCcpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgJHNjb3BlLnByb2plY3RMaXN0ID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgLy9yZXNwb25zZS5kYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgIC8vICAgIGl0ZW0ucHJvamVjdF9uYW1lID0gaXRlbS5wcmltYXJ5X2NhdC50b0xvd2VyQ2FzZSgpO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLmRlbGV0ZVByb2plY3RJdGVtID0gZnVuY3Rpb24gKGxpbmVJRCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIkRlbGV0aW5nLi4uXCIsICRzY29wZS5wcm9qZWN0bGlzdC5saW5lSUQpO1xuICAgICAgICAkaHR0cC51cGRhdGUoJy9wcm9qZWN0JykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIC8vZmluZE9uZSBhbmQgZGVsZXRlIGJ5IElEIHVzaW5nIHByb2plY3RsaXN0LmxpbmVJRFxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJJdGVtIHdhcyBkZWxldGVkLlwiLCByZXNwb25zZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyRzY29wZS5jYWxjdWxhdGVQcm9qZWN0VG90YWwoKXtcbiAgICAgICAgLy8vL2ZvckVhY2ggcHJvamVjdFxuICAgICAgICAvLyAgICB2YXIgcHJvamVjdFRvdGFsKz1wcm9qZWN0TGlzdC5jbzJfb2Zmc2V0O1xuICAgICAgICAvLyAgICByZXR1cm4gcHJvamVjdFRvdGFsO1xuICAgICAgICAvLy8vc2F2ZSB0byBwcm9qZWN0PyBvciBqdXN0IHJlY2FsYyBlYWNoIHRpbWU/XG4gICAgICAgIC8vfVxuICAgIH07XG59XSk7XG5cblxuLy9EYXNoYm9hcmQgUGFnZSAtIEtpbS9NYWRlbGVpbmVcbmFwcC5jb250cm9sbGVyKCdkYXNoYm9hcmRDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG4gICAgLy9sb2FkIHByb2plY3QgbGlzdCBvbiBwYWdlIGxvYWRcbiAgICAkaHR0cC5nZXQoJy9wcm9qZWN0JykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICRzY29wZS5wcm9qZWN0TGlzdCA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICAgIC8vcmVzcG9uc2UuZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAvLyAgICBpdGVtLnByb2plY3RfbmFtZSA9IGl0ZW0ucHJpbWFyeV9jYXQudG9Mb3dlckNhc2UoKTtcbiAgICB9KTtcbn1dKTtcblxuXG4vLyBTZXJ2aWNlcyBmb3IgYXV0aGVudGljYXRpb25cbmFwcC5zZXJ2aWNlKCdhdXRoU2VydmljZScsIFsnJHdpbmRvdycsIGZ1bmN0aW9uICgkd2luZG93KXtcbiAgICB0aGlzLnBhcnNlSnd0ID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IHRva2VuLnNwbGl0KCcuJylbMV07XG4gICAgICAgICAgICB2YXIgYmFzZTY0ID0gYmFzZTY0VXJsLnJlcGxhY2UoJy0nLCAnKycpLnJlcGxhY2UoJ18nLCAnLycpO1xuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoJHdpbmRvdy5hdG9iKGJhc2U2NCkpO1xuICAgICAgICB9IGVsc2UgcmV0dXJuIHt9O1xuICAgIH07XG5cbiAgICB0aGlzLnNhdmVUb2tlbiA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbiA9IHRva2VuO1xuICAgICAgICBjb25zb2xlLmxvZygnU2F2ZWQgdG9rZW46Jywkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbik7XG4gICAgfTtcblxuICAgIHRoaXMuZ2V0VG9rZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgdGhpcy5pc0F1dGhlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRva2VuID0gdGhpcy5nZXRUb2tlbigpO1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBwYXJhbXMgPSB0aGlzLnBhcnNlSnd0KHRva2VuKTtcbiAgICAgICAgICAgIHZhciBub3RFeHBpcmVkID0gTWF0aC5yb3VuZChuZXcgRGF0ZSgpLmdldFRpbWUoKSAvIDEwMDApIDw9IHBhcmFtcy5leHA7XG4gICAgICAgICAgICBpZiAoIW5vdEV4cGlyZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ291dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vdEV4cGlyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdGhpcy5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGRlbGV0ZSAkd2luZG93LmxvY2FsU3RvcmFnZS5qd3RUb2tlbjtcbiAgICB9O1xuXG4gICAgLy8gZXhwb3NlIHVzZXIgYXMgYW4gb2JqZWN0XG4gICAgdGhpcy5nZXRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXJzZUp3dCh0aGlzLmdldFRva2VuKCkpXG4gICAgfTtcbn1dKTtcblxuYXBwLmZhY3RvcnkoJ2F1dGhJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJ2F1dGhTZXJ2aWNlJywgZnVuY3Rpb24gKCRxLCAkbG9jYXRpb24sIGF1dGhTZXJ2aWNlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcbiAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS5pc0F1dGhlZCgpKSB7XG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIGF1dGhTZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY29uZmlnO1xuICAgICAgICB9LFxuICAgICAgICByZXNwb25zZTogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuXG4gICAgICAgICAgICAgICAgLy8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UgfHwgJHEud2hlbihyZXNwb25zZSk7XG4gICAgICAgIH0sIHJlc3BvbnNlRXJyb3I6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvbG9naW5cIik7XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XG4gICAgICAgIH1cbiAgICB9O1xufV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
