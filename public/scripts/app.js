var app=angular.module("ecotoneApp",["ngRoute","ngMaterial","ngMessages","validation.match"]);app.config(["$mdThemingProvider","$routeProvider","$locationProvider","$httpProvider",function(t,e,o,n){o.html5Mode(!0),t.theme("default").primaryPalette("green").accentPalette("blue-grey",{"default":"600"}).warnPalette("orange"),e.when("/",{templateUrl:"/views/calculator.html",controller:"calculateCtrl as ctrl"}).when("/login",{templateUrl:"/views/login.html",controller:"loginCtrl"}).when("/register",{templateUrl:"/views/register.html",controller:"createAccountCtrl"}).when("/admin",{templateUrl:"/views/admin.html",controller:"adminCtrl as ctrl"}).when("/account",{templateUrl:"/views/account.html",controller:""}).when("/dashboard",{templateUrl:"/views/dashboard.html",controller:"projectsCtrl"}).when("/projects",{templateUrl:"/views/project.html",controller:"projectsCtrl"}).when("/about",{templateUrl:"/views/about.html"}).when("/contact",{templateUrl:"/views/contact.html",controller:""}).when("/privacy",{templateUrl:"/views/privacy.html"}).when("/sources",{templateUrl:"/views/sources.html"}).otherwise({redirectTo:"/"})}]),app.controller("calculateCtrl",["$http","$mdDialog","$rootScope","authService","$location",function(t,e,o,n,r){function a(t){console.log("Text changed to ",t)}function l(t){void 0==t&&(p.category="",p.subcategory="",p.warmId="",p.weight="",p.conversion="",p.result="")}function c(){var e={warmId:p.warmId||p.category.secondaries[0].warm_id,weight:parseFloat(p.weight)*p.conversion};t.post("/calculations",e).then(function(t){p.result=Math.floor(1e3*Math.abs(t.data))/1e3})}function s(t){return t?p.list.filter(i(t)):p.list}function i(t){var e=t.toLowerCase();return function(t){return-1!=t.primary_cat.indexOf(e)}}function u(){console.log("SUBMIT!"),console.log(p.submission),t.post("/suggestion",p.submission).then(function(t){e.hide()})}function h(t){console.log("NEW SUGGESTION!",p.searchText),e.show({templateUrl:"/views/submit-modal.html",clickOutsideToClose:!0,controller:"calculateCtrl",controllerAs:"ctrl",locals:{material:p.searchText}})}o.user=n.getUser(),o.user&&o.user.username&&r.path("/"),t.get("/materials").then(function(t){var e=t.data;e.forEach(function(t){t.primary_cat=t.primary_cat.toLowerCase()}),p.list=e});var p=this;p.list="",p.result="",p.querySearch=s,p.selectedItemChange=l,p.searchTextChange=a,p.newSuggestion=h,p.submitSuggestion=u,p.units=[{name:"lbs",conversion:5e-4},{name:"kilos",conversion:.00110231},{name:"tons",conversion:1},{name:"metric tons",conversion:1.10231}],p.submission={email:"",material:"",notes:""},p.newCalculation=c}]),app.controller("adminCtrl",["$http",function(t){function e(e){var n=e.id;console.log(n),t.put("/suggestion/complete/"+n).then(function(t){o()})}function o(){t.get("/suggestion").then(function(t){var e=t.data;console.log(e),n.suggestions=e})}o();var n=this;n.suggestions="",n.markComplete=e}]),app.controller("createAccountCtrl",["$scope","$http","$location",function(t,e,o){t.user={},t.processForm=function(n){console.log("Posting..."),e({method:"POST",url:"/register",data:t.user,dataType:"json"}).then(function(t){console.log(t),o.path("/login"),alert("Your account has been created.")})}}]),app.controller("loginCtrl",["$scope","$http","authService","$location","$rootScope",function(t,e,o,n,r){t.login=function(){e({method:"POST",url:"/login",data:t.form}).then(function(t){o.saveToken(t.data.token),r.user=o.getUser(),n.path("/")})}}]),app.controller("navCtrl",["authService","$scope","$rootScope","$location","$http",function(t,e,o,n,r){o.user=t.getUser(),o.user&&o.user.username&&n.path("/"),e.logout=function(){t.logout(),o.user=t.getUser(),n.path("/")}}]),app.controller("projectsCtrl",["$scope","$http",function(t,e){e.get("/project").then(function(e){console.log(e),t.projectList=e.data}),e({method:"GET",url:"http://www.w3schools.com/angular/customers.php"}).then(function(e){t.names=e.records})}]),app.service("authService",["$window",function(t){this.parseJwt=function(e){if(e){var o=e.split(".")[1],n=o.replace("-","+").replace("_","/");return JSON.parse(t.atob(n))}return{}},this.saveToken=function(e){t.localStorage.jwtToken=e,console.log("Saved token:",t.localStorage.jwtToken)},this.getToken=function(){return t.localStorage.jwtToken},this.isAuthed=function(){var t=this.getToken();if(t){var e=this.parseJwt(t),o=Math.round((new Date).getTime()/1e3)<=e.exp;return o||this.logout(),o}return!1},this.logout=function(){delete t.localStorage.jwtToken},this.getUser=function(){return this.parseJwt(this.getToken())}}]),app.factory("authInterceptor",["$q","$location","authService",function(t,e,o){return{request:function(t){return t.headers=t.headers||{},o.isAuthed()&&(t.headers.Authorization="Bearer "+o.getToken()),t},response:function(o){return 401===o.status&&e.path("/login"),o||t.when(o)},responseError:function(o){return 401===o.status?e.path("/login"):console.log(o),t.reject(o)}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMvYXBwLmpzIl0sIm5hbWVzIjpbImFwcCIsImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkbWRUaGVtaW5nUHJvdmlkZXIiLCIkcm91dGVQcm92aWRlciIsIiRsb2NhdGlvblByb3ZpZGVyIiwiJGh0dHBQcm92aWRlciIsImh0bWw1TW9kZSIsInRoZW1lIiwicHJpbWFyeVBhbGV0dGUiLCJhY2NlbnRQYWxldHRlIiwiZGVmYXVsdCIsIndhcm5QYWxldHRlIiwid2hlbiIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsIm90aGVyd2lzZSIsInJlZGlyZWN0VG8iLCIkaHR0cCIsIiRtZERpYWxvZyIsIiRyb290U2NvcGUiLCJhdXRoU2VydmljZSIsIiRsb2NhdGlvbiIsInNlYXJjaFRleHRDaGFuZ2UiLCJ0ZXh0IiwiY29uc29sZSIsImxvZyIsInNlbGVjdGVkSXRlbUNoYW5nZSIsIml0ZW0iLCJ1bmRlZmluZWQiLCJzZWxmIiwiY2F0ZWdvcnkiLCJzdWJjYXRlZ29yeSIsIndhcm1JZCIsIndlaWdodCIsImNvbnZlcnNpb24iLCJyZXN1bHQiLCJuZXdDYWxjdWxhdGlvbiIsImNhbGN1bGF0ZSIsInNlY29uZGFyaWVzIiwid2FybV9pZCIsInBhcnNlRmxvYXQiLCJwb3N0IiwidGhlbiIsInJlc3BvbnNlIiwiTWF0aCIsImZsb29yIiwiYWJzIiwiZGF0YSIsInF1ZXJ5U2VhcmNoIiwicXVlcnkiLCJsaXN0IiwiZmlsdGVyIiwiY3JlYXRlRmlsdGVyRm9yIiwibG93ZXJjYXNlUXVlcnkiLCJ0b0xvd2VyQ2FzZSIsIm9iaiIsInByaW1hcnlfY2F0IiwiaW5kZXhPZiIsInN1Ym1pdFN1Z2dlc3Rpb24iLCJzdWJtaXNzaW9uIiwicmVzIiwiaGlkZSIsIm5ld1N1Z2dlc3Rpb24iLCJzdWdnZXN0aW9uIiwic2VhcmNoVGV4dCIsInNob3ciLCJjbGlja091dHNpZGVUb0Nsb3NlIiwiY29udHJvbGxlckFzIiwibG9jYWxzIiwibWF0ZXJpYWwiLCJ1c2VyIiwiZ2V0VXNlciIsInVzZXJuYW1lIiwicGF0aCIsImdldCIsImZvckVhY2giLCJ0aGlzIiwidW5pdHMiLCJuYW1lIiwiZW1haWwiLCJub3RlcyIsIm1hcmtDb21wbGV0ZSIsImlkIiwicHV0IiwiaW5pdCIsInN1Z2dlc3Rpb25zIiwiJHNjb3BlIiwicHJvY2Vzc0Zvcm0iLCJtZXRob2QiLCJ1cmwiLCJkYXRhVHlwZSIsImFsZXJ0IiwibG9naW4iLCJmb3JtIiwic2F2ZVRva2VuIiwidG9rZW4iLCJsb2dvdXQiLCJwcm9qZWN0TGlzdCIsIm5hbWVzIiwicmVjb3JkcyIsInNlcnZpY2UiLCIkd2luZG93IiwicGFyc2VKd3QiLCJiYXNlNjRVcmwiLCJzcGxpdCIsImJhc2U2NCIsInJlcGxhY2UiLCJKU09OIiwicGFyc2UiLCJhdG9iIiwibG9jYWxTdG9yYWdlIiwiand0VG9rZW4iLCJnZXRUb2tlbiIsImlzQXV0aGVkIiwicGFyYW1zIiwibm90RXhwaXJlZCIsInJvdW5kIiwiRGF0ZSIsImdldFRpbWUiLCJleHAiLCJmYWN0b3J5IiwiJHEiLCJyZXF1ZXN0IiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJzdGF0dXMiLCJyZXNwb25zZUVycm9yIiwicmVqZWN0Il0sIm1hcHBpbmdzIjoiQUFBQSxHQUFJQSxLQUFNQyxRQUFRQyxPQUFPLGNBQWUsVUFBVyxhQUFjLGFBQWMsb0JBRS9FRixLQUFJRyxRQUFRLHFCQUFzQixpQkFBa0Isb0JBQXFCLGdCQUFpQixTQUFTQyxFQUFvQkMsRUFBZ0JDLEVBQW1CQyxHQUN0SkQsRUFBa0JFLFdBQVUsR0FHNUJKLEVBQW1CSyxNQUFNLFdBQ3BCQyxlQUFlLFNBQ2ZDLGNBQWMsYUFBY0MsVUFBVSxRQUN0Q0MsWUFBYSxVQUdsQlIsRUFBZVMsS0FBSyxLQUVaQyxZQUFhLHlCQUNiQyxXQUFZLDBCQUNiRixLQUFLLFVBRUpDLFlBQWEsb0JBQ2JDLFdBQVksY0FDYkYsS0FBSyxhQUVKQyxZQUFhLHVCQUNiQyxXQUFZLHNCQUNiRixLQUFLLFVBRUpDLFlBQWEsb0JBQ2JDLFdBQVksc0JBRWJGLEtBQUssWUFFSkMsWUFBYSxzQkFDYkMsV0FBWSxLQUNiRixLQUFLLGNBRUpDLFlBQWEsd0JBQ2JDLFdBQVksaUJBQ2JGLEtBQUssYUFFSkMsWUFBYSxzQkFDYkMsV0FBWSxpQkFDYkYsS0FBSyxVQUVKQyxZQUFhLHNCQUNkRCxLQUFLLFlBRUpDLFlBQWEsc0JBQ2JDLFdBQVksS0FDYkYsS0FBSyxZQUVKQyxZQUFhLHdCQUNkRCxLQUFLLFlBRUpDLFlBQWEsd0JBQ2RFLFdBQ0NDLFdBQVksU0FNeEJsQixJQUFJZ0IsV0FBVyxpQkFBa0IsUUFBUyxZQUFhLGFBQWMsY0FBZSxZQUFhLFNBQVVHLEVBQU9DLEVBQVdDLEVBQVlDLEVBQWFDLEdBMERsSixRQUFTQyxHQUFpQkMsR0FDdEJDLFFBQVFDLElBQUksbUJBQW9CRixHQUdwQyxRQUFTRyxHQUFtQkMsR0FDWEMsUUFBUkQsSUFDREUsRUFBS0MsU0FBVyxHQUNoQkQsRUFBS0UsWUFBYyxHQUNuQkYsRUFBS0csT0FBUyxHQUNkSCxFQUFLSSxPQUFTLEdBQ2RKLEVBQUtLLFdBQWEsR0FDbEJMLEVBQUtNLE9BQVMsSUFJdEIsUUFBU0MsS0FFTCxHQUFJQyxJQUNBTCxPQUFRSCxFQUFLRyxRQUFVSCxFQUFLQyxTQUFTUSxZQUFZLEdBQUdDLFFBQ3BETixPQUFRTyxXQUFXWCxFQUFLSSxRQUFVSixFQUFLSyxXQUczQ2pCLEdBQU13QixLQUFLLGdCQUFpQkosR0FBV0ssS0FBSyxTQUFTQyxHQUNqRGQsRUFBS00sT0FBU1MsS0FBS0MsTUFBZ0MsSUFBMUJELEtBQUtFLElBQUlILEVBQVNJLE9BQWdCLE1Ba0JuRSxRQUFTQyxHQUFZQyxHQUNqQixNQUFPQSxHQUFRcEIsRUFBS3FCLEtBQUtDLE9BQU9DLEVBQWdCSCxJQUFVcEIsRUFBS3FCLEtBR25FLFFBQVNFLEdBQWdCSCxHQUNyQixHQUFJSSxHQUFpQkosRUFBTUssYUFDM0IsT0FBTyxVQUFrQkMsR0FDckIsTUFBbUQsSUFBM0NBLEVBQUlDLFlBQVlDLFFBQVFKLElBSXhDLFFBQVNLLEtBQ0xsQyxRQUFRQyxJQUFJLFdBQ1pELFFBQVFDLElBQUlJLEVBQUs4QixZQUNqQjFDLEVBQU13QixLQUFLLGNBQWVaLEVBQUs4QixZQUFZakIsS0FBSyxTQUFVa0IsR0FDdkQxQyxFQUFVMkMsU0FJakIsUUFBU0MsR0FBZUMsR0FDcEJ2QyxRQUFRQyxJQUFJLGtCQUFtQkksRUFBS21DLFlBRXBDOUMsRUFBVStDLE1BQ05wRCxZQUFhLDJCQUNicUQscUJBQXFCLEVBQ3JCcEQsV0FBWSxnQkFDWnFELGFBQWMsT0FDZEMsUUFBU0MsU0FBVXhDLEVBQUttQyxjQTNIaEM3QyxFQUFXbUQsS0FBT2xELEVBQVltRCxVQUUzQnBELEVBQVdtRCxNQUFRbkQsRUFBV21ELEtBQUtFLFVBQ2xDbkQsRUFBVW9ELEtBQUssS0FJbkJ4RCxFQUFNeUQsSUFBSSxjQUFjaEMsS0FBSyxTQUFTQyxHQUNsQyxHQUFJTyxHQUFPUCxFQUFTSSxJQUVwQkcsR0FBS3lCLFFBQVEsU0FBU2hELEdBQ2xCQSxFQUFLNkIsWUFBYzdCLEVBQUs2QixZQUFZRixnQkFJeEN6QixFQUFLcUIsS0FBT0EsR0FLaEIsSUFBSXJCLEdBQU8rQyxJQUVYL0MsR0FBS3FCLEtBQU8sR0FDWnJCLEVBQUtNLE9BQVMsR0FDZE4sRUFBS21CLFlBQWNBLEVBQ25CbkIsRUFBS0gsbUJBQXFCQSxFQUMxQkcsRUFBS1AsaUJBQXFCQSxFQUMxQk8sRUFBS2lDLGNBQWdCQSxFQUNyQmpDLEVBQUs2QixpQkFBbUJBLEVBQ3hCN0IsRUFBS2dELFFBRUdDLEtBQU0sTUFDTjVDLFdBQVksT0FHWjRDLEtBQU0sUUFDTjVDLFdBQVksWUFHWjRDLEtBQU0sT0FDTjVDLFdBQVksSUFHWjRDLEtBQU0sY0FDTjVDLFdBQVksVUFHcEJMLEVBQUs4QixZQUNEb0IsTUFBTyxHQUNQVixTQUFVLEdBQ1ZXLE1BQU8sSUFFWG5ELEVBQUtPLGVBQWlCQSxLQWtGMUJ0QyxJQUFJZ0IsV0FBVyxhQUFjLFFBQVMsU0FBVUcsR0FRNUMsUUFBU2dFLEdBQWNsQixHQUNuQixHQUFJbUIsR0FBS25CLEVBQVdtQixFQUNwQjFELFNBQVFDLElBQUl5RCxHQUNaakUsRUFBTWtFLElBQUksd0JBQTBCRCxHQUFJeEMsS0FBSyxTQUFVa0IsR0FDbkR3QixNQUlSLFFBQVNBLEtBQ0xuRSxFQUFNeUQsSUFBSSxlQUFlaEMsS0FBSyxTQUFVa0IsR0FDcEMsR0FBSXlCLEdBQWN6QixFQUFJYixJQUN0QnZCLFNBQVFDLElBQUk0RCxHQUNaeEQsRUFBS3dELFlBQWNBLElBbEIzQkQsR0FFQSxJQUFJdkQsR0FBTytDLElBQ1gvQyxHQUFLd0QsWUFBYyxHQUNuQnhELEVBQUtvRCxhQUFlQSxLQXNCeEJuRixJQUFJZ0IsV0FBVyxxQkFBc0IsU0FBVSxRQUFTLFlBQWEsU0FBU3dFLEVBQVFyRSxFQUFPSSxHQUN6RmlFLEVBQU9oQixRQUVQZ0IsRUFBT0MsWUFBYyxTQUFVakIsR0FDM0I5QyxRQUFRQyxJQUFJLGNBQ1pSLEdBQ0l1RSxPQUFRLE9BQ1JDLElBQUssWUFDTDFDLEtBQU11QyxFQUFPaEIsS0FDYm9CLFNBQVUsU0FDWGhELEtBQUssU0FBVUMsR0FDZG5CLFFBQVFDLElBQUlrQixHQUNadEIsRUFBVW9ELEtBQUssVUFDZmtCLE1BQU0sd0NBTWxCN0YsSUFBSWdCLFdBQVcsYUFBYyxTQUFVLFFBQVMsY0FBZSxZQUFhLGFBQWMsU0FBU3dFLEVBQVFyRSxFQUFPRyxFQUFhQyxFQUFXRixHQUN0SW1FLEVBQU9NLE1BQVEsV0FDWDNFLEdBQ0l1RSxPQUFRLE9BQ1JDLElBQUssU0FDTDFDLEtBQU11QyxFQUFPTyxPQUNkbkQsS0FBSyxTQUFTQyxHQUNidkIsRUFBWTBFLFVBQVVuRCxFQUFTSSxLQUFLZ0QsT0FDcEM1RSxFQUFXbUQsS0FBT2xELEVBQVltRCxVQUM5QmxELEVBQVVvRCxLQUFLLFdBTTNCM0UsSUFBSWdCLFdBQVcsV0FBWSxjQUFlLFNBQVUsYUFBYyxZQUFhLFFBQVMsU0FBU00sRUFBYWtFLEVBQVFuRSxFQUFZRSxFQUFXSixHQUN6SUUsRUFBV21ELEtBQU9sRCxFQUFZbUQsVUFFM0JwRCxFQUFXbUQsTUFBUW5ELEVBQVdtRCxLQUFLRSxVQUNsQ25ELEVBQVVvRCxLQUFLLEtBR25CYSxFQUFPVSxPQUFTLFdBQ1o1RSxFQUFZNEUsU0FDWjdFLEVBQVdtRCxLQUFPbEQsRUFBWW1ELFVBQzlCbEQsRUFBVW9ELEtBQUssU0FLdkIzRSxJQUFJZ0IsV0FBVyxnQkFBaUIsU0FBVSxRQUFTLFNBQVN3RSxFQUFRckUsR0FDaEVBLEVBQU15RCxJQUFJLFlBQVloQyxLQUFLLFNBQVNDLEdBQ2hDbkIsUUFBUUMsSUFBSWtCLEdBQ1oyQyxFQUFPVyxZQUFjdEQsRUFBU0ksT0FHbEM5QixHQUNJdUUsT0FBUSxNQUNSQyxJQUFLLG1EQUNOL0MsS0FBSyxTQUFVQyxHQUNkMkMsRUFBT1ksTUFBUXZELEVBQVN3RCxhQU1oQ3JHLElBQUlzRyxRQUFRLGVBQWdCLFVBQVcsU0FBVUMsR0FDN0N6QixLQUFLMEIsU0FBVyxTQUFVUCxHQUN0QixHQUFJQSxFQUFPLENBQ1AsR0FBSVEsR0FBWVIsRUFBTVMsTUFBTSxLQUFLLEdBQzdCQyxFQUFTRixFQUFVRyxRQUFRLElBQUssS0FBS0EsUUFBUSxJQUFLLElBQ3RELE9BQU9DLE1BQUtDLE1BQU1QLEVBQVFRLEtBQUtKLElBQzVCLFVBR1g3QixLQUFLa0IsVUFBWSxTQUFVQyxHQUN2Qk0sRUFBUVMsYUFBYUMsU0FBV2hCLEVBQ2hDdkUsUUFBUUMsSUFBSSxlQUFlNEUsRUFBUVMsYUFBYUMsV0FHcERuQyxLQUFLb0MsU0FBVyxXQUNaLE1BQU9YLEdBQVFTLGFBQWFDLFVBR2hDbkMsS0FBS3FDLFNBQVcsV0FDWixHQUFJbEIsR0FBUW5CLEtBQUtvQyxVQUNqQixJQUFJakIsRUFBTyxDQUNQLEdBQUltQixHQUFTdEMsS0FBSzBCLFNBQVNQLEdBQ3ZCb0IsRUFBYXZFLEtBQUt3RSxPQUFNLEdBQUlDLE9BQU9DLFVBQVksTUFBU0osRUFBT0ssR0FJbkUsT0FIS0osSUFDRHZDLEtBQUtvQixTQUVGbUIsRUFFUCxPQUFPLEdBSWZ2QyxLQUFLb0IsT0FBUyxpQkFDSEssR0FBUVMsYUFBYUMsVUFJaENuQyxLQUFLTCxRQUFVLFdBQ1gsTUFBT0ssTUFBSzBCLFNBQVMxQixLQUFLb0MsZ0JBSWxDbEgsSUFBSTBILFFBQVEsbUJBQW9CLEtBQU0sWUFBYSxjQUFlLFNBQVVDLEVBQUlwRyxFQUFXRCxHQUN2RixPQUNJc0csUUFBUyxTQUFVekgsR0FLZixNQUpBQSxHQUFPMEgsUUFBVTFILEVBQU8wSCxZQUNwQnZHLEVBQVk2RixhQUNaaEgsRUFBTzBILFFBQVFDLGNBQWdCLFVBQVl4RyxFQUFZNEYsWUFFcEQvRyxHQUVYMEMsU0FBVSxTQUFVQSxHQU9oQixNQUx3QixPQUFwQkEsRUFBU2tGLFFBR1R4RyxFQUFVb0QsS0FBSyxVQUVaOUIsR0FBWThFLEVBQUc3RyxLQUFLK0IsSUFDNUJtRixjQUFlLFNBQVVuRixHQU94QixNQU53QixPQUFwQkEsRUFBU2tGLE9BQ1R4RyxFQUFVb0QsS0FBSyxVQUdmakQsUUFBUUMsSUFBSWtCLEdBRVQ4RSxFQUFHTSxPQUFPcEYiLCJmaWxlIjoic2NyaXB0cy9hcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2Vjb3RvbmVBcHAnLCBbJ25nUm91dGUnLCAnbmdNYXRlcmlhbCcsICduZ01lc3NhZ2VzJywgJ3ZhbGlkYXRpb24ubWF0Y2gnXSk7XG5cbmFwcC5jb25maWcoWyckbWRUaGVtaW5nUHJvdmlkZXInLCAnJHJvdXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCAnJGh0dHBQcm92aWRlcicsIGZ1bmN0aW9uKCRtZFRoZW1pbmdQcm92aWRlciwgJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyKXtcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XG5cbiAgICAvL3NldCB0aGVtZSBhbmQgY29sb3IgcGFsZXR0ZVxuICAgICRtZFRoZW1pbmdQcm92aWRlci50aGVtZSgnZGVmYXVsdCcpXG4gICAgICAgIC5wcmltYXJ5UGFsZXR0ZSgnZ3JlZW4nKVxuICAgICAgICAuYWNjZW50UGFsZXR0ZSgnYmx1ZS1ncmV5JywgeydkZWZhdWx0JzonNjAwJ30pXG4gICAgICAgIC53YXJuUGFsZXR0ZSAoJ29yYW5nZScpO1xuXG4gICAgLy9yb3V0ZXMgZm9yIHZpZXdzXG4gICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2NhbGN1bGF0b3IuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY2FsY3VsYXRlQ3RybCBhcyBjdHJsJ1xuICAgICAgICB9KS53aGVuKCcvbG9naW4nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9sb2dpbi5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdsb2dpbkN0cmwnXG4gICAgICAgIH0pLndoZW4oJy9yZWdpc3RlcicsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3JlZ2lzdGVyLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2NyZWF0ZUFjY291bnRDdHJsJ1xuICAgICAgICB9KS53aGVuKCcvYWRtaW4nLFxuICAgICAgICB7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy92aWV3cy9hZG1pbi5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdhZG1pbkN0cmwgYXMgY3RybCdcblxuICAgICAgICB9KS53aGVuKCcvYWNjb3VudCcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2FjY291bnQuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnJ1xuICAgICAgICB9KS53aGVuKCcvZGFzaGJvYXJkJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvZGFzaGJvYXJkLmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ3Byb2plY3RzQ3RybCdcbiAgICAgICAgfSkud2hlbignL3Byb2plY3RzJyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcHJvamVjdC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdwcm9qZWN0c0N0cmwnXG4gICAgICAgIH0pLndoZW4oJy9hYm91dCcsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL2Fib3V0Lmh0bWwnXG4gICAgICAgIH0pLndoZW4oJy9jb250YWN0JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvY29udGFjdC5odG1sJyxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICcnXG4gICAgICAgIH0pLndoZW4oJy9wcml2YWN5JyxcbiAgICAgICAge1xuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvdmlld3MvcHJpdmFjeS5odG1sJ1xuICAgICAgICB9KS53aGVuKCcvc291cmNlcycsXG4gICAgICAgIHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3NvdXJjZXMuaHRtbCdcbiAgICAgICAgfSkub3RoZXJ3aXNlKHtcbiAgICAgICAgICAgIHJlZGlyZWN0VG86ICcvJ1xuICAgICAgICB9KTtcblxuICAgIC8vJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnYXV0aEludGVyY2VwdG9yJyk7XG59XSk7XG5cbmFwcC5jb250cm9sbGVyKCdjYWxjdWxhdGVDdHJsJywgWyckaHR0cCcsICckbWREaWFsb2cnLCAnJHJvb3RTY29wZScsICdhdXRoU2VydmljZScsICckbG9jYXRpb24nLCBmdW5jdGlvbiggJGh0dHAsICRtZERpYWxvZywgJHJvb3RTY29wZSwgYXV0aFNlcnZpY2UsICRsb2NhdGlvbiApIHtcblxuICAgIC8vIENoZWNrIHVzZXJcbiAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG5cbiAgICBpZigkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9XG5cbiAgICAvLyBJTklUXG4gICAgJGh0dHAuZ2V0KCcvbWF0ZXJpYWxzJykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICB2YXIgbGlzdCA9IHJlc3BvbnNlLmRhdGE7XG5cbiAgICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgaXRlbS5wcmltYXJ5X2NhdCA9IGl0ZW0ucHJpbWFyeV9jYXQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIC8vIC9pdGVtLnByaW1hcnlfY2F0ID0gaXRlbS5wcmltYXJ5X2NhdC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGl0ZW0ucHJpbWFyeV9jYXQuc2xpY2UoMSkudG9Mb3dlckNhc2UoKTtcblxuICAgICAgICB9KTtcbiAgICAgICAgc2VsZi5saXN0ID0gbGlzdDtcblxuICAgIH0pO1xuXG4gICAgLy8gU2VsZiBkZWNcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICBzZWxmLmxpc3QgPSAnJztcbiAgICBzZWxmLnJlc3VsdCA9ICcnO1xuICAgIHNlbGYucXVlcnlTZWFyY2ggPSBxdWVyeVNlYXJjaDtcbiAgICBzZWxmLnNlbGVjdGVkSXRlbUNoYW5nZSA9IHNlbGVjdGVkSXRlbUNoYW5nZTtcbiAgICBzZWxmLnNlYXJjaFRleHRDaGFuZ2UgICA9IHNlYXJjaFRleHRDaGFuZ2U7XG4gICAgc2VsZi5uZXdTdWdnZXN0aW9uID0gbmV3U3VnZ2VzdGlvbjtcbiAgICBzZWxmLnN1Ym1pdFN1Z2dlc3Rpb24gPSBzdWJtaXRTdWdnZXN0aW9uO1xuICAgIHNlbGYudW5pdHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdsYnMnLFxuICAgICAgICAgICAgY29udmVyc2lvbjogMC4wMDA1XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICdraWxvcycsXG4gICAgICAgICAgICBjb252ZXJzaW9uOiAwLjAwMTEwMjMxXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIG5hbWU6ICd0b25zJyxcbiAgICAgICAgICAgIGNvbnZlcnNpb246IDFcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ21ldHJpYyB0b25zJyxcbiAgICAgICAgICAgIGNvbnZlcnNpb246IDEuMTAyMzFcbiAgICAgICAgfVxuICAgIF07XG4gICAgc2VsZi5zdWJtaXNzaW9uID0ge1xuICAgICAgICBlbWFpbDogJycsXG4gICAgICAgIG1hdGVyaWFsOiAnJyxcbiAgICAgICAgbm90ZXM6ICcnXG4gICAgfTtcbiAgICBzZWxmLm5ld0NhbGN1bGF0aW9uID0gbmV3Q2FsY3VsYXRpb247XG5cblxuICAgIGZ1bmN0aW9uIHNlYXJjaFRleHRDaGFuZ2UodGV4dCkge1xuICAgICAgICBjb25zb2xlLmxvZygnVGV4dCBjaGFuZ2VkIHRvICcsIHRleHQpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNlbGVjdGVkSXRlbUNoYW5nZShpdGVtKSB7XG4gICAgICAgIGlmICggaXRlbSA9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBzZWxmLmNhdGVnb3J5ID0gJyc7XG4gICAgICAgICAgICBzZWxmLnN1YmNhdGVnb3J5ID0gJyc7XG4gICAgICAgICAgICBzZWxmLndhcm1JZCA9ICcnO1xuICAgICAgICAgICAgc2VsZi53ZWlnaHQgPSAnJztcbiAgICAgICAgICAgIHNlbGYuY29udmVyc2lvbiA9ICcnO1xuICAgICAgICAgICAgc2VsZi5yZXN1bHQgPSAnJztcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG5ld0NhbGN1bGF0aW9uKCkge1xuXG4gICAgICAgIHZhciBjYWxjdWxhdGUgPSB7XG4gICAgICAgICAgICB3YXJtSWQ6IHNlbGYud2FybUlkIHx8IHNlbGYuY2F0ZWdvcnkuc2Vjb25kYXJpZXNbMF0ud2FybV9pZCxcbiAgICAgICAgICAgIHdlaWdodDogcGFyc2VGbG9hdChzZWxmLndlaWdodCkgKiBzZWxmLmNvbnZlcnNpb25cbiAgICAgICAgfTtcblxuICAgICAgICAkaHR0cC5wb3N0KCcvY2FsY3VsYXRpb25zJywgY2FsY3VsYXRlKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBzZWxmLnJlc3VsdCA9IE1hdGguZmxvb3IoTWF0aC5hYnMocmVzcG9uc2UuZGF0YSkgKiAxMDAwKSAvIDEwMDA7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNhdmVUb1Byb2plY3QoKXtcbiAgICAgICAgdmFyIGxpbmVJdGVtID0ge1xuICAgICAgICAgICAgY2F0ZWdvcnk6IHNlbGYuY2F0ZWdvcnksXG4gICAgICAgICAgICBzdWJjYXRlZ29yeTogc2VsZi5zdWJjYXRlZ29yeSxcbiAgICAgICAgICAgIHdhcm1fSWQ6IHNlbGYud2FybUlkLFxuICAgICAgICAgICAgd2VpZ2h0OiBwYXJzZUZsb2F0KHNlbGYud2VpZ2h0KSpzZWxmLmNvbnZlcnNpb24sXG4gICAgICAgICAgICB1bml0czogc2VsZi51bml0Lm5hbWVcbiAgICAgICAgfTtcbiAgICAgICAgY29uc29sZS5sb2cobGluZUl0ZW0pO1xuICAgICAgICAkaHR0cC5wb3N0KCcvYWRkVG9Qcm9qZWN0JykudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBxdWVyeVNlYXJjaChxdWVyeSkge1xuICAgICAgICByZXR1cm4gcXVlcnkgPyBzZWxmLmxpc3QuZmlsdGVyKGNyZWF0ZUZpbHRlckZvcihxdWVyeSkpIDogc2VsZi5saXN0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUZpbHRlckZvcihxdWVyeSkge1xuICAgICAgICB2YXIgbG93ZXJjYXNlUXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpIC8vcXVlcnkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBxdWVyeS5zbGljZSgxKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGZpbHRlckZuKG9iaikge1xuICAgICAgICAgICAgcmV0dXJuIChvYmoucHJpbWFyeV9jYXQuaW5kZXhPZihsb3dlcmNhc2VRdWVyeSkgIT0gLTEpO1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN1Ym1pdFN1Z2dlc3Rpb24oKXtcbiAgICAgICAgY29uc29sZS5sb2coJ1NVQk1JVCEnKTtcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi5zdWJtaXNzaW9uKTtcbiAgICAgICAgJGh0dHAucG9zdCgnL3N1Z2dlc3Rpb24nLCBzZWxmLnN1Ym1pc3Npb24pLnRoZW4oZnVuY3Rpb24oIHJlcyApe1xuICAgICAgICAgICAkbWREaWFsb2cuaGlkZSgpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBuZXdTdWdnZXN0aW9uKCBzdWdnZXN0aW9uICl7XG4gICAgICAgIGNvbnNvbGUubG9nKCdORVcgU1VHR0VTVElPTiEnLCBzZWxmLnNlYXJjaFRleHQpO1xuXG4gICAgICAgICRtZERpYWxvZy5zaG93KHtcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3ZpZXdzL3N1Ym1pdC1tb2RhbC5odG1sJyxcbiAgICAgICAgICAgIGNsaWNrT3V0c2lkZVRvQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnY2FsY3VsYXRlQ3RybCcsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICdjdHJsJyxcbiAgICAgICAgICAgIGxvY2Fsczoge21hdGVyaWFsOiBzZWxmLnNlYXJjaFRleHR9XG4gICAgICAgIH0pXG5cbiAgICB9XG5cblxufV0pO1xuXG4vKipcbiAqIEFETUlOXG4gKi9cbmFwcC5jb250cm9sbGVyKCdhZG1pbkN0cmwnLCBbJyRodHRwJywgZnVuY3Rpb24oICRodHRwICl7XG4gICAgLy8gSU5JVFxuICAgIGluaXQoKTtcblxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBzZWxmLnN1Z2dlc3Rpb25zID0gJyc7XG4gICAgc2VsZi5tYXJrQ29tcGxldGUgPSBtYXJrQ29tcGxldGU7XG5cbiAgICBmdW5jdGlvbiBtYXJrQ29tcGxldGUoIHN1Z2dlc3Rpb24gKSB7XG4gICAgICAgIHZhciBpZCA9IHN1Z2dlc3Rpb24uaWQ7XG4gICAgICAgIGNvbnNvbGUubG9nKGlkKTtcbiAgICAgICAgJGh0dHAucHV0KCcvc3VnZ2VzdGlvbi9jb21wbGV0ZS8nICsgaWQpLnRoZW4oZnVuY3Rpb24oIHJlcyApIHtcbiAgICAgICAgICAgIGluaXQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgJGh0dHAuZ2V0KCcvc3VnZ2VzdGlvbicpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgdmFyIHN1Z2dlc3Rpb25zID0gcmVzLmRhdGE7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzdWdnZXN0aW9ucyk7XG4gICAgICAgICAgICBzZWxmLnN1Z2dlc3Rpb25zID0gc3VnZ2VzdGlvbnM7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG59XSk7XG5cbi8vIFJlZ2lzdGVyIEhUTUwgLSBNYWRlbGluZVxuYXBwLmNvbnRyb2xsZXIoJ2NyZWF0ZUFjY291bnRDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnJGxvY2F0aW9uJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJGxvY2F0aW9uKSB7XG4gICAgJHNjb3BlLnVzZXIgPSB7fTtcblxuICAgICRzY29wZS5wcm9jZXNzRm9ybSA9IGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiUG9zdGluZy4uLlwiKTtcbiAgICAgICAgJGh0dHAoe1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICB1cmw6ICcvcmVnaXN0ZXInLFxuICAgICAgICAgICAgZGF0YTogJHNjb3BlLnVzZXIsXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2xvZ2luJyk7XG4gICAgICAgICAgICBhbGVydChcIllvdXIgYWNjb3VudCBoYXMgYmVlbiBjcmVhdGVkLlwiKVxuICAgICAgICB9KVxuICAgIH07XG59XSk7XG5cbi8vIExvZ2luIEhUTUwgLSBLYXRlXG5hcHAuY29udHJvbGxlcignbG9naW5DdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCAnYXV0aFNlcnZpY2UnLCAnJGxvY2F0aW9uJywgJyRyb290U2NvcGUnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCBhdXRoU2VydmljZSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlKSB7XG4gICAgJHNjb3BlLmxvZ2luID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAkaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIHVybDogJy9sb2dpbicsXG4gICAgICAgICAgICBkYXRhOiAkc2NvcGUuZm9ybVxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnNhdmVUb2tlbihyZXNwb25zZS5kYXRhLnRva2VuKTtcbiAgICAgICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvJyk7XG4gICAgICAgIH0pXG4gICAgfVxufV0pO1xuXG4vLyBDaGFuZ2UgTmF2aWdhdGlvbiBPcHRpb25zIHdpdGggTG9naW5cbmFwcC5jb250cm9sbGVyKCduYXZDdHJsJywgWydhdXRoU2VydmljZScsICckc2NvcGUnLCAnJHJvb3RTY29wZScsICckbG9jYXRpb24nLCAnJGh0dHAnLCBmdW5jdGlvbihhdXRoU2VydmljZSwgJHNjb3BlLCAkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRodHRwKXtcbiAgICAkcm9vdFNjb3BlLnVzZXIgPSBhdXRoU2VydmljZS5nZXRVc2VyKCk7XG5cbiAgICBpZigkcm9vdFNjb3BlLnVzZXIgJiYgJHJvb3RTY29wZS51c2VyLnVzZXJuYW1lKXtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9XG5cbiAgICAkc2NvcGUubG9nb3V0ID0gZnVuY3Rpb24oKXtcbiAgICAgICAgYXV0aFNlcnZpY2UubG9nb3V0KCk7XG4gICAgICAgICRyb290U2NvcGUudXNlciA9IGF1dGhTZXJ2aWNlLmdldFVzZXIoKTtcbiAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy8nKTtcbiAgICB9XG59XSk7XG5cbi8vIFByb2plY3QgSFRNTCAtIERhc2hib2FyZCBIVE1MIC0gS2ltXG5hcHAuY29udHJvbGxlcigncHJvamVjdHNDdHJsJywgWyckc2NvcGUnLCAnJGh0dHAnLCBmdW5jdGlvbigkc2NvcGUsICRodHRwKSB7XG4gICAgJGh0dHAuZ2V0KCcvcHJvamVjdCcpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAkc2NvcGUucHJvamVjdExpc3QgPSByZXNwb25zZS5kYXRhO1xuICAgIH0pO1xuXG4gICAgJGh0dHAoe1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICB1cmw6ICdodHRwOi8vd3d3Lnczc2Nob29scy5jb20vYW5ndWxhci9jdXN0b21lcnMucGhwJ1xuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICRzY29wZS5uYW1lcyA9IHJlc3BvbnNlLnJlY29yZHM7XG4gICAgfSk7XG5cbn1dKTtcblxuLy8gU2VydmljZXMgZm9yIGF1dGhlbnRpY2F0aW9uXG5hcHAuc2VydmljZSgnYXV0aFNlcnZpY2UnLCBbJyR3aW5kb3cnLCBmdW5jdGlvbiAoJHdpbmRvdyl7XG4gICAgdGhpcy5wYXJzZUp3dCA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgICAgIHZhciBiYXNlNjRVcmwgPSB0b2tlbi5zcGxpdCgnLicpWzFdO1xuICAgICAgICAgICAgdmFyIGJhc2U2NCA9IGJhc2U2NFVybC5yZXBsYWNlKCctJywgJysnKS5yZXBsYWNlKCdfJywgJy8nKTtcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKCR3aW5kb3cuYXRvYihiYXNlNjQpKTtcbiAgICAgICAgfSBlbHNlIHJldHVybiB7fTtcbiAgICB9O1xuXG4gICAgdGhpcy5zYXZlVG9rZW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW4gPSB0b2tlbjtcbiAgICAgICAgY29uc29sZS5sb2coJ1NhdmVkIHRva2VuOicsJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW4pO1xuICAgIH07XG5cbiAgICB0aGlzLmdldFRva2VuID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW47XG4gICAgfTtcblxuICAgIHRoaXMuaXNBdXRoZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTtcbiAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW1zID0gdGhpcy5wYXJzZUp3dCh0b2tlbik7XG4gICAgICAgICAgICB2YXIgbm90RXhwaXJlZCA9IE1hdGgucm91bmQobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKSA8PSBwYXJhbXMuZXhwO1xuICAgICAgICAgICAgaWYgKCFub3RFeHBpcmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dvdXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBub3RFeHBpcmVkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMubG9nb3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBkZWxldGUgJHdpbmRvdy5sb2NhbFN0b3JhZ2Uuand0VG9rZW47XG4gICAgfTtcblxuICAgIC8vIGV4cG9zZSB1c2VyIGFzIGFuIG9iamVjdFxuICAgIHRoaXMuZ2V0VXNlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VKd3QodGhpcy5nZXRUb2tlbigpKVxuICAgIH07XG59XSk7XG5cbmFwcC5mYWN0b3J5KCdhdXRoSW50ZXJjZXB0b3InLCBbJyRxJywgJyRsb2NhdGlvbicsICdhdXRoU2VydmljZScsIGZ1bmN0aW9uICgkcSwgJGxvY2F0aW9uLCBhdXRoU2VydmljZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XG4gICAgICAgICAgICBpZiAoYXV0aFNlcnZpY2UuaXNBdXRoZWQoKSkge1xuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSAnQmVhcmVyICcgKyBhdXRoU2VydmljZS5nZXRUb2tlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcbiAgICAgICAgfSxcbiAgICAgICAgcmVzcG9uc2U6IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEpIHtcblxuICAgICAgICAgICAgICAgIC8vIGhhbmRsZSB0aGUgY2FzZSB3aGVyZSB0aGUgdXNlciBpcyBub3QgYXV0aGVudGljYXRlZFxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlIHx8ICRxLndoZW4ocmVzcG9uc2UpO1xuICAgICAgICB9LCByZXNwb25zZUVycm9yOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwMSkge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKFwiL2xvZ2luXCIpO1xuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgfTtcbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
